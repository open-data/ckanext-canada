{# It is not possible to use to ckan_extends due to the very different formatting that WET uses with forms #}
{% import 'macros/form.html' as form %}

{% set placeholder = placeholder if placeholder else _('Search...') %}
{% set sorting = sorting if sorting else [(_('Name Ascending'), 'name asc'), (_('Name Descending'), 'name desc')] %}
{% set search_class = search_class if search_class else 'search-giant' %}
{% set sort_arg = request.args.get('sort') %}

<form class="form-inline mrgn-bttm-lg" role="form" method="get" data-module="select-switch">
  {% block search_input %}
    {% block search_input_label %}
      <label for="search_field" class="wb-inv">{{ _('Search Datasets') }}</label>
    {% endblock %}
    <div class="input-group col-md-12">
      <div class="canada-search-field-wrapper">
        <input type="text" class="form-control" id="search_field" autocomplete="off" name="q" value="{{ query }}" placeholder="{{ placeholder }}">
        <span class="input-group-btn">
          {% block search_input_button %}
            <button class="btn btn-primary btn-small" type="submit">
              <i class="fa fa-search" aria-hidden="true"></i><span class="wb-inv">{{ _('Search') }}</span>
            </button>
          {% endblock %}
        </span>
      </div>
    </div>
  {% endblock %}

  {% block search_search_fields %}
    {% if g.fields -%}
      <span>{{ form.hidden_from_list(fields=fields) }}</span>
    {%- endif %}
  {% endblock %}

  {% block search_form_midsection %}{% endblock %}

  {% block search_title %}
    {% if not no_title %}
      <div class="row mrgn-tp-md">
        <div class="col-md-12">
          <div class="canada-search-form-options-wrapper">
            {% if count==0 %}
              <div class="text-center text-warning">
                <strong>{% snippet 'snippets/search_result_text.html', query=query, count=count, type=type %}</strong>
              </div>
            {% else %}
              <div class="mrgn-tp-sm text-left text-success">
                <strong>{% snippet 'snippets/search_result_text.html', query=query, count=count, type=type %}</strong>
              </div>
              <div class="text-left">
                {% snippet "snippets/sort_by.html", sort=sort_arg %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endif %}
  {% endblock %}

  {% block filter_list %}
    <div class="filter-list">
      {% for field in g.fields_grouped %}
        {% for link, label in h.search_filter_pill_link_label(field, extras) %}
          <a href="{{ link }}" class="btn btn-info btn-xs mrgn-lft-sm mrgn-bttm-sm facet-pill" title="{{ _('Remove') }}">
            {{ _('Published') if label == 'public' else label }}&nbsp;<i class="fa fa-times" aria-hidden="true"></i></a>
          </a>
        {% endfor %}
      {% endfor %}
    </div>
  {% endblock %}

  {% block search_form_footer %}{% endblock %}
</form>
