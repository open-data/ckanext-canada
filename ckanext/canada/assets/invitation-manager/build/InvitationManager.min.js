function imSetup(){"use strict";var debugMode,surveyDB,surveyScope,dbURL,Adobe,overrideID,overrideScope=!1,overrideStart=!1,storageNames_session="im-settings";try{dbURL?mainPart1():function(){var scripts=document.getElementsByTagName("script"),i=0,path="";for(;i<scripts.length;){var src=scripts[i].src;if(src.indexOf("InvitationManager.js")>-1){path=src.substring(0,src.lastIndexOf("/")+1);break}i++}window.imConfigPath&&(path=window.imConfigPath);$.getJSON(path+"config.JSON",function(){consoleLog("Get Config File Path is Successful")}).done(function(result){var myConfig=JSON.parse(JSON.stringify(result));dbURL=myConfig.dbURL,Adobe=myConfig.Adobe,dbURL&&mainPart1()}).fail(function(){consoleLog("Get Config File Path Failed")}).always(function(){consoleLog("Get Config File Path is Completed")})}()}catch(e){return!1}function mainPart1(){if(dbURL)if(debugMode=function(){/[?&]logim=(true|1)/i.test(document.location.search)&&localStorage.setItem("imlog",1);/[?&]logim=(false|0)/i.test(document.location.search)&&localStorage.removeItem("imlog");return 1==localStorage.getItem("imlog")}(),consoleLog("Start"),function(){/[?&]im_nocookiecheck=1/i.test(document.location.search)&&(consoleLog("Treat visitor as new visitor (deleting locally stored data)"),localStorage.removeItem("lastDateIMShown"));/[?&]im_scope=page/i.test(document.location.search)?overrideScope="Page":/[?&]im_scope=site/i.test(document.location.search)&&(overrideScope="Entire site");/[?&]im_nodatecheck=1/i.test(document.location.search)&&(overrideStart=!0);var b=/[?&]im_surveyid=([^?&]+)/.exec(document.location.search);null!==b&&(overrideID=b[1])}(),consoleLog("Check Test Params"),getCookie("lastDateIMShown"))consoleLog("User has seen an invitation already"),downloadSurveyDB(),localStorage.setItem("lastDateIMShown",new Date(getCookie("lastDateIMShown")));else if(consoleLog("lastDateIMShown === null"),surveyDB=JSON.parse(sessionStorage.getItem(storageNames_session)))if(localStorage.getItem("lastDateIMShown")){var maxNbDaysIMPersist=new Date(localStorage.getItem("lastDateIMShown"));maxNbDaysIMPersist.setDate(maxNbDaysIMPersist.getDate()+surveyDB.settings["duration-delay"]),setCookie("lastDateIMShown",localStorage.getItem("lastDateIMShown"),maxNbDaysIMPersist,removeSubdomain(window.location.href.toLowerCase()))}else mainPart2();else consoleLog("downloadSurveyDB"),downloadSurveyDB()}function mainPart2(){if(surveyDB&&surveyDB.settings){if(getCookie("lastDateIMShown")){if(!function(storageDate){var now=new Date,maxNbDaysIMPersist=surveyDB.settings["duration-delay"];if(now-storageDate<=864e5*maxNbDaysIMPersist||!storageDate)return!1;return!0}(lastDateIMShown=new Date(getCookie("lastDateIMShown"))))return;document.cookie="lastDateIMShown=;expires=Thu, 01 Jan 1970 00:00:00 GMT; Secure;domain="+removeSubdomain(window.location.href.toLowerCase())+";path=/",localStorage.removeItem("lastDateIMShown")}surveyDB.settings.scopeHat||function(){var tmpSurveyDB={settings:{},surveys:[]};consoleLog("Rolling probability for scope hat"),overrideScope?(surveyScope=overrideScope,consoleLog("surveyScope = overrideScope = "+overrideScope)):consoleLog("surveyScope = getWeightedRandom = "+(surveyScope=getWeightedRandom({Page:surveyDB.settings["page-probability"],"Entire site":surveyDB.settings["site-probability"]})));var list=getObjArr(surveyDB.surveys);consoleLog(list.length+" potential surveys, removing surveys that don't match scope hat");for(var i=0;i<list.length;i++)list[i].type==surveyScope&&(tmpSurveyDB.surveys[tmpSurveyDB.surveys.length]=list[i]);tmpSurveyDB.settings["page-probability"]=surveyDB.settings["page-probability"],tmpSurveyDB.settings["site-probability"]=surveyDB.settings["site-probability"],tmpSurveyDB.settings.scopeHat=surveyScope,tmpSurveyDB.settings.whitelist=surveyDB.settings.whitelist,tmpSurveyDB.settings.blacklist=surveyDB.settings.blacklist,tmpSurveyDB.settings["duration-delay"]=surveyDB.settings["duration-delay"],surveyDB=tmpSurveyDB}(),overrideScope&&(surveyDB.settings.scopeHat=overrideScope),consoleLog("Scope hat = "+(surveyScope=surveyDB.settings.scopeHat)+", "+surveyDB.surveys.length+" potential surveys, removing surveys outside of date range");for(var list=surveyDB.surveys,i=0;i<list.length;i++){var n=(new Date).getTime(),end_time=new Date(list[i]["end-on"]).getTime();if(n<new Date(list[i]["start-on"]).getTime()||n>=end_time){if(overrideStart&&n<end_time)continue;list.splice(i,1),i--}}consoleLog(list.length+" potential surveys, removing surveys based on targeting"),surveyDB.surveys=list,sessionStorage.setItem(storageNames_session,JSON.stringify(surveyDB)),consoleLog("Checking whitelist");list=getObjArr(surveyDB.settings.whitelist);var h=(a=document.location).host+a.pathname,didMatch=!1;if(!list)return!1;for(i=0;i<list.length;i++){(b=new RegExp(list[i].url,"i")).test(h)&&(didMatch=!0)}if(!didMatch)return!1;consoleLog("Checking blacklist");var a;for(list=getObjArr(surveyDB.settings.blacklist),h=(a=document.location).host+a.pathname,i=0;i<list.length;i++){var l=list[i].url;if(void 0!==l&&void 0!==l.length&&l.toLowerCase()==h.toLowerCase())return!1}consoleLog("Removing surveys based on page attributes");var cpySurveys=JSON.parse(JSON.stringify(surveyDB.surveys)),b=getWeightedRandom(function(){for(var surveySubList={},url=document.location.host+document.location.pathname,count=0,i=0;i<surveyDB.surveys.length;i++){var survey_i=surveyDB.surveys[i];if(overrideID){if(survey_i.id!==overrideID)continue;survey_i.probability=100}switch(survey_i.type){case"Entire site":for(var sublist=getObjArr(survey_i["survey-urls"]),c=0;c<sublist.length;c++){new RegExp(sublist[c].site,"i").test(url)&&(surveySubList[survey_i.id]=survey_i.probability*surveyDB.settings["site-probability"],count++,surveyDB.surveys.splice(i,1),i--)}break;case"Page":sublist=getObjArr(survey_i["survey-urls"]);var wLocation=window.location.href.toLowerCase();for(c=0;c<sublist.length;c++)-1!==wLocation.indexOf(sublist[c].url.toLowerCase())&&i>=0&&(surveySubList[survey_i.id]=survey_i.probability*surveyDB.settings["page-probability"],count++,surveyDB.surveys.splice(i,1),i--)}}return consoleLog(count+" potential surveys, selecting a survey"),surveySubList}());if(b){for(var j=0;j<cpySurveys.length;j++)if(cpySurveys[j].id===b){var selectedSurveyIndex=j;break}if(consoleLog("Select survey "+cpySurveys[selectedSurveyIndex].name),function(survey){var popupInput,referrerPath=encodeURIComponent(window.location.pathname),surveyLink=survey["link-"+wb_im.lang],delimiter="?";surveyLink.includes("?")&&(delimiter="&");popupInput="yes"===Adobe.toLowerCase()?"<input type='hidden' name='popupName' value='"+survey.name+"'>":"";var html="<aside id='gc-im-popup' class='asideBody gc-im-wb-overlay gc-im-modal-content gc-im-overlay-def gc-im-wb-popup-mid shadow' tabindex='0' ><header class='gc-im-modal-header'><div class='gc-im-modal-title'><div class='gc-im-modal-title-fix1'>"+survey["title-"+wb_im.lang]+"</div><div class='gc-im-modal-title-fix2'><button id='close-im' type='button' class='gc-im-overlaydef closeIcon zoomX' aria-label='Close' >&times;</button></div><div class='clearfix'></div></div></header><div class='gc-im-modal-body'>"+survey["body-"+wb_im.lang]+"<ul class='list-inline mrgn-sm'><li class='mrgn-sm marginBottom-yes'><a id='survey-yes' class='gc-im-btn gc-im-btn-primary' href='"+survey["link-"+wb_im.lang]+delimiter+"ref="+referrerPath+"' target='_blank' referrer-policy='unsafe-url'>"+survey["yes-"+wb_im.lang]+"</a></li> <li class='mrgn-sm marginBottom-no'><button id='survey-no' class='gc-im-btn gc-im-btn-secondary survey-close'>"+survey["no-"+wb_im.lang]+"</button></li></ul>"+popupInput+"</div><div class='gc-im-modal-footer  hidden'></div></aside>",$html=$(html);$html.bind("click vclick mouseup keydown",function(e){(("click"===e.type||"vclick"===e.type)&&1===e.which&&$(e.target).closest("a, button",this).length||"mouseup"===e.type&&2===e.which&&$(e.target).closest("a",this).length||"keydown"===e.type&&27===e.which)&&($html.removeClass("open"),$("#first-focus").remove(),$("#wb-info").removeClass("im-mrgn"),$(this).hide(),setTimeout(function(){$html.empty()},1e3),$(this).off()),"keydown"===e.type&&9===e.which&&"survey-no"===e.target.id&&setTimeout(function(){$("#wb-tphp").trigger("focus")},1e3),"keydown"===e.type&&9===e.which&&16===e.which&&"close-im"===e.target.id&&setTimeout(function(){$("#wb-tphp").trigger("focus")},1e3)}),$("main").before($html),$("#survey-yes").attr("target","_blank"),"fr"===wb_im.lang?$("#wb-tphp").prepend("<li id='first-focus' class='wb-slc'><a  class='wb-sl' href='#gc-im-popup'>Passer au Gestionnaire des Invitations</a></li> "):$("#wb-tphp").prepend("<li id='first-focus' class='wb-slc'><a   class='wb-sl' href='#gc-im-popup'>Skip to Invitation Manager Popup</a></li> ");if($("#gc-im-popup").trigger("wb-init.gc-im-wb-overlay"),$("#gc-im-popup").trigger("open.gc-im-wb-overlay"),!$html.is(":hidden")&&"yes"===Adobe.toLowerCase()){var popUpName=$("input[name='popupName']").val();_satellite.setVar("jsPopupName",popUpName),_satellite.track("popUpImpression")}$(window).on("resize scroll",function(){var bottomY=25,$footer=$("#wb-info");$html.is(":hidden")?$footer.removeClass("im-mrgn"):$footer.addClass("im-mrgn"),$(window).scrollTop()>=$(document).outerHeight()-$(window).outerHeight()-$footer.outerHeight()?$html.css({bottom:$footer.outerHeight()-($(document).outerHeight()-$(window).outerHeight()-$(window).scrollTop())+bottomY}):$html.css({bottom:bottomY})})}(cpySurveys[selectedSurveyIndex]),!getCookie("lastDateIMShown")&&!/[?&]im_nocookiecheck=1/i.test(document.location.search)){var maxNbDaysIMPersist=new Date,lastDateIMShown=new Date;maxNbDaysIMPersist.setDate(maxNbDaysIMPersist.getDate()+surveyDB.settings["duration-delay"]),localStorage.setItem("lastDateIMShown",lastDateIMShown),setCookie("lastDateIMShown",lastDateIMShown,maxNbDaysIMPersist,removeSubdomain(window.location.href.toLowerCase()))}}else consoleLog("No survey selected, "+surveyDB.surveys.length+" surveys remain in session storage"),sessionStorage.setItem(storageNames_session,JSON.stringify(surveyDB))}}function consoleLog(val){debugMode&&console.log("Invitation Mgr: "+val)}function downloadSurveyDB(){$.getJSON(dbURL,function(){consoleLog("Get Json File is Successful")}).done(function(result){surveyDB=JSON.parse(JSON.stringify(result)),mainPart2()}).fail(function(){consoleLog("Fail to get JSON File")}).always(function(){consoleLog("JSON file Complete")})}function getWeightedRandom(spec){var i,sum=0,r=Math.random();for(i in spec)if(0!==spec[i]&&r<=(sum+=parseFloat(spec[i])))return i}function getObjArr(o){return o?Array.isArray(o)?o:[o]:[]}function removeSubdomain(url){const urlSegments=new URL(url).hostname.split(".");var arrIndex=["gc","qc"].indexOf(urlSegments.slice(-2)[0])>=0?3:2;return urlSegments.slice(0).slice(-arrIndex).join(".")}function getCookie(name){return!!document.cookie.split(";").some(item=>item.trim().startsWith(name+"="))&&document.cookie.split("; ").find(row=>row.startsWith(name.trim())).split("=")[1]}function setCookie(cName,cValue,cExpDate,cDomain){document.cookie=cName+"="+cValue+";expires="+cExpDate+";domain="+cDomain+";Secure;path=/"}}window.addEventListener("load",imSetup);