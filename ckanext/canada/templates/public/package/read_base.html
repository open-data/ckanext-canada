{% ckan_extends %}

{% import 'macros/canada_read.html' as cr %}

{% set pkg = c.pkg_dict %}
{% set client_lang = h.lang() %}
{% set schema = h.scheming_get_dataset_schema(pkg.type) %}

Remove the markdown_extract call because our notes is a dict not a string:
{% block head_extras %}
<meta property="og:title" content="{{ h.dataset_display_name(pkg) }} - {{ g.site_title }}">
{% endblock %}


{% block page_header %}{% endblock %}

{% block content_primary_nav %}{% endblock %}

{% set page_title  = _('{record_title} - Open Data Portal - Open Data') %}
{% block title %}{{ pkg.title[client_lang] }}{% endblock %}

{% block secondary_content %}

  {% block ds_socialmedia %} 
  {% include "package/snippets/socialmedia.html" %}
  {% endblock ds_socialmedia %}

  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">
        {{ _('Additional Information') }}
      </div>
    </div>
    <ul class="list-group">
      {% set exclude = [
        "title",
        "owner_org",
        "org_title_at_publication",
        "collection",
        "title_translated",
        "notes_translated",
        "restrictions",
        "imso_approval",
        "ready_to_publish",
        "date_published",
        "date_modified",
        "frequency"
      ] %}
      {% for field in schema.dataset_fields if field.field_name not in exclude %}
        {% set field_title = h.scheming_language_text(field.label) %}
        {% if field_title %}
          {% set field_value = pkg[field.field_name] %}
          {% if pkg[field.field_name] is mapping %}
          {% set field_value = h.scheming_language_text(field_value) %}
          {% endif %}
          {% if field_value %}
            <li class="list-group-item">
              <strong>{{ field_title }}:</strong>
              {% snippet 'scheming/snippets/display_field.html',
                field=field,
                data=pkg,
                entity_type='dataset',
                object_type=pkg.type
              %}
            </li>
          {% endif %}
        {% endif %}
      {% endfor %}
    </ul>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
    <div class="panel-title">{{_('About this Record')}}</div>
    <a href="{{ h.url_for(action='history', controller='package', id=pkg.id)
      }}?format=atom" title="RSS"><span class="fa fa-rss"></span> {{_('RSS Feed')}}</a>
    </div>

    <ul class="list-group">
      {% set owner_org = h.scheming_field_by_name(schema.dataset_fields, 'owner_org') %}
      <li class="list-group-item"><b>{{ h.scheming_language_text(owner_org.label) }}:</b>
        <br/>
        {{ cr.split_bilingual_field(pkg.organization.title) }}
      </li>

      {% set date_published = h.scheming_field_by_name(schema.dataset_fields,
        'date_published') %}
      <li class="list-group-item"><b>{{
        h.scheming_language_text(date_published.label) }}:</b>
        {% snippet 'scheming/snippets/display_field.html',
          field=date_published, data=pkg, entity_type='dataset', object_type=pkg.type %}
      </li>

      {% if pkg.date_modified %}
        {% set date_modified = h.scheming_field_by_name(schema.dataset_fields,
          'date_modified') %}
        <li class="list-group-item"><b>{{
          h.scheming_language_text(date_modified.label) }}:</b>
          {% snippet 'scheming/snippets/display_field.html',
            field=date_modified, data=pkg, entity_type='dataset', object_type=pkg.type %}
        </li>
      {% endif %}

      {%- set period_start = schema_description.dataset_field_by_id['time_period_coverage_start'] -%}
      {%- set start_date = cr.date_field(period_start, pkg) -%}
      {%- set period_end = schema_description.dataset_field_by_id['time_period_coverage_end'] -%}
      {%- set end_date = cr.date_field(period_end, pkg) -%}

      {% if start_date or end_date %}
      <li class="list-group-item"><b>{{ _('Temporal Coverage') }}:</b>
        <small>
        {% if start_date and end_date and end_date != '9999-09-09' %}
          {{ start_date }} {{ _('to') }} {{ end_date }}
        {% elif start_date %}
          {{ start_date }} {{ _('to undefined') }}
        {% elif end_date %}
          {{ _('undefined to') }} {{ end_date }}
        {% endif %}
        </small>
      </li>
      {% endif %}

      {% set frequency = h.scheming_field_by_name(schema.dataset_fields,
        'frequency') %}
      <li class="list-group-item"><b>{{
        h.scheming_language_text(frequency.label) }}:</b>
        {% snippet 'scheming/snippets/display_field.html',
          field=frequency, data=pkg, entity_type='dataset', object_type=pkg.type %}
      </li>

      {% if pkg.type == 'dataset' and pkg.get('collection') != 'fgp' %}
        <li class="list-group-item">
          <ul class="list-unstyled">
            <li><a href="{{ '/en/openness-rating' if h.lang() == 'en' else
                '/fr/cote-degre-douvertrure-des-donnees' }}"><b>{{ _('Openness rating') }}</b></a>:
                {%- set openness = h.openness_score(pkg) -%}
                <img src="{{ h.url_for_static('/static/img/stars/star'
                  ~ openness ~ '.png') }}" alt="{{
                    ['',
                    _('one star'),
                    _('two stars'),
                    _('three stars'),
                    _('four stars'),
                    _('five stars'),
                    ][openness] }}"
                    class="image-actual margin-bottom-none openness-rating-stars" />
            </li>
          </ul>
        </li>
      {% endif %}
      {% if pkg.status %}
        {% set status = h.scheming_field_by_name(schema.dataset_fields,
          'status') %}
        <li class="list-group-item"><b>{{
          h.scheming_language_text(status.label) }}:</b>
          {% snippet 'scheming/snippets/display_field.html',
            field=status, data=pkg, entity_type='dataset', object_type=pkg.type %}
        </li>
      {% endif %}
      {% if pkg.spatial_representation_type %}
        {% set srep = h.scheming_field_by_name(schema.dataset_fields,
          'spatial_representation_type') %}
        <li class="list-group-item"><b>{{
          h.scheming_language_text(srep.label) }}:</b>
          {% snippet 'scheming/snippets/display_field.html',
            field=srep, data=pkg, entity_type='dataset', object_type=pkg.type %}
        </li>
      {% endif %}
    </ul>

    <!-- 
    {# Need these for Open Maps
    <ul class="list-group">
      <li class="list-group-item" style="background-color:#FFC0CB"><b>Status:</b>
        <small>
        {# {{ cr.subject_field(subjects, pkg, client_lang) }} #}
        </small>
      </li>      
      <li class="list-group-item" style="background-color:#FFC0CB"><b>Spatial Representation Type:</b>
        <small>
        {# {{ cr.subject_field(subjects, pkg, client_lang) }} #}
        </small>
      </li>      
    </ul>
    #}
    -->

  </div>

{% endblock %}
