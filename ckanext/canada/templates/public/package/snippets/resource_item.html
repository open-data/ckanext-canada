{# vim: set filetype=jinja sw=2 sts=2: #}
{% import 'macros/canada_read.html' as cr %}

{% set url = h.url_for(controller='package', action='resource_read', id=pkg.name, resource_id=res.id) %}
{% set lang_field = schema_description.resource_field_by_id['language'] %}
{% set format_field = schema_description.resource_field_by_id['format'] %}

<div class="span-1 row-start align-right">
  {% block resource_item_title %}
  <a class="heading" href="{{ url }}" title="{{ res.name or res.description }}">
    <span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ res.format }}
    </span>
  </a>
</div>
<div class="span-5 row-end ">
  <a class="heading" style="word-wrap: break-word;" href="{{ url }}" title="{{ res.name or res.description }}">
    {{ cr.resource_display_name(res, client_lang) | truncate(100) }}
    {{ h.popular('views', res.tracking_summary.total, min=10) }}
  </a>
  {% endblock resource_item_title %}
  <p class="description">
    {{ cr.field_label(format_field, client_lang) }}:
    {{ cr.field(format_field, res, client_lang) }},
    {{ cr.field_label(lang_field, client_lang) }}:
    {{ cr.lookup_field(lang_field, res, client_lang) }}
  </p>
  {% block resource_item_explore %}
  <div class="dropdown btn-group">
    <ul class="menu-horizontal">
      {% block resource_item_explore_links %}
      {# if the resource is stored locally, then offer the preview button
        h.debug_inspect(res) #}
      {% if res.webstore_last_updated %}
      <li>
        <a href="{{ url }}" class="button"><span class="wb-icon-table"></span>{{ _('Preview') }}</a>
      </li>
      {% endif %}
      <li>
        <a href="{{ res.url }}" class="resource-url-analytics button" target="_blank"><span class="wb-icon-drive-download"></span>{{ _('Download') }}</a>
      </li>
      {% endblock %}
    </ul>
  </div>
  {% endblock %}
</div>
