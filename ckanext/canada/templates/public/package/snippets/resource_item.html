{% import 'macros/canada_read.html' as cr %}

{% set url_action = 'resource_edit' if url_is_edit and can_edit else 'resource_read' %}
{% set url = h.url_for(controller='package', action=url_action, id=pkg.name, resource_id=res.id) %}

{# Previous variables from Open Maps, delete if no issue #}
{# set size_field = schema_description.resource_field_by_id['size'] #}

{% set schema = h.scheming_get_dataset_schema(pkg.type) %}
{% set name_field = h.scheming_field_by_name(schema.resource_fields, 'name_translated') %}
{% set type_field = h.scheming_field_by_name(schema.resource_fields, 'resource_type') %}
{% set format_field = h.scheming_field_by_name(schema.resource_fields, 'format') %}
{% set lang_field = h.scheming_field_by_name(schema.resource_fields, 'language') %}

{# FIXME: using tables for formatting #}
<tr>
  <td>
    {% snippet 'scheming/snippets/display_field.html',
      field=name_field, data=res, entity_type='dataset', object_type=pkg.type %}
    {% set csv_dict = h.recombinant_csv_dict(res.id) %}
    {% if csv_dict %}
      <details style="display: inline; border-style: none;"><summary style="outline: none;">{{ _('Data Columns info') }}</summary>
      <table class="table table-striped resource-list">
        <thead>
          <tr>
              <th>{{ _('Column name') }}</th>
              <th>{{ _('English descirption') }}</th>
              <th>{{ _('French description') }}</th>
          </tr>
        </thead>
      {% for col_name, col_en, col_fr in csv_dict %}
          <tr>
              <td>{{ col_name }}</td>
              <td>{{ col_en }}</td>
              <td>{{ col_fr }}</td>
          </tr>
      {% endfor %}
      </table>
      </details>
    {% endif %}
  </td>
  <td class="td-center">
    {% snippet 'scheming/snippets/display_field.html',
      field=type_field, data=res, entity_type='dataset', object_type=pkg.type %}
  </td>
  <td nowrap class="td-center">
    {% snippet 'scheming/snippets/display_field.html',
      field=format_field, data=res, entity_type='dataset', object_type=pkg.type %}
  </td>
  <td class="td-center">
    {% snippet 'scheming/snippets/display_field.html',
      field=lang_field, data=res, entity_type='dataset', object_type=pkg.type %}
  </td>
  <td nowrap class="td-center">
    <a href="{{ res.url }}" title="{{_('Resource') ~ ' ' ~ res_num}}" class="resource-url-analytics btn btn-primary" target="_blank">
      {{ _('Access') }}
    </a>
    {% if res.webstore_last_updated %}
    <a href="{{ url }}" class="btn btn-default" >{{ _('Preview') }}</a>
    {% endif %}
    {% if can_edit %}
    {% link_for _('Edit'), controller='package', action='resource_edit', id=pkg.name, resource_id=res.id, class_='btn btn-default' %}
    {% endif %}
  </td>
</tr>
