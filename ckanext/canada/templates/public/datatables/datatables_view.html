{% ckan_extends %}

{%- block datatable_column_label -%}
  {%- set label = 'label_' + h.lang() -%}
  {%- if label in field.info and field.info[label] -%}
    {# remove encode when upgrading to CKAN 2.9 - applied as a fix for OPEN-2054 #}
    {{ field.info[label].encode('ascii', 'xmlcharrefreplace') | safe }}
  {%- else -%}
    {{ field.id }}
  {%- endif -%}
{%- endblock -%}

{%- block links -%}
  {{super()}}
  {%- block meta -%}
    {{ super() }}
    {% block adobe_analytics_meta %}
      {%- block adobe_analytics_title -%}
      <meta property="dcterms:title" content="{{ g.site_title }}" />
      {%- endblock -%}
      <meta property="dcterms:language" content="{{ h.adobe_analytics_lang() }}" />
      {%- block adobe_analytics_creator -%}
      {# remove encode when moving from fanstatic - applied as a fix for OPEN-1566 #}
      <meta property="dcterms:creator" content="{{ _('Treasury Board of Canada Secretariat').encode('ascii', 'xmlcharrefreplace') | safe }}"/>
      {%- endblock -%}
      <meta property="dcterms:service" content="OG-GO" />
      <meta property="dcterms:accessRights" content="{{ h.adobe_analytics_login_required(h.full_current_url()) }}" />
    {%- endblock -%}
  {%- endblock -%}

  {%- block google_analytics -%}
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', '{{ h.googleanalytics_id() }}', 'auto');
    if (location.hostname == 'localhost') {
      ga('set', 'sendHitTask', null);
    }
    ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->
  {%- endblock -%}

  {% block adobe_analytics %}
    {% if h.adobe_analytics_js() %}
      <script src="{{ h.adobe_analytics_js() }}"></script>
    {% endif %}
  {%- endblock -%}
{%- endblock -%}

{% block scripts %}
  {% block adobe_analytics_footer %}
    <script type="text/javascript">_satellite.pageBottom();</script>
  {%- endblock -%}
  {% block google_analytics_footer %}{%- endblock -%}
  {{ super() }}
{% endblock %}
