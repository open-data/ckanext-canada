function load_pd_datatable(e){const t=e._,a=new URLSearchParams(document.location.search),n=((new Date).toISOString().split("T")[0],(new Date).getFullYear()),r=e.options.locale,d=e.options.locale_string,l=e.options.timezone_string,i=e.options.csrf_name,s=e.options.csrf_value,o=e.options.resource_id,c=e.options.resource_name,p=e.options.edit_single_uri,u=e.options.edit_records_uri,f=e.options.upsert_records_uri,b=e.options.delete_records_uri,m=e.options.ajax_uri,h=e.options.primary_keys,v=e.options.foreign_keys,g=e.options.foreign_links,y=e.options.chromo_fields,_=e.options.is_editable,x=e.options.table_styles,w=pd_datatables__EDITOR,k=t("Select All"),T=t("Search:"),C=t("Sorting by:"),S=t("Ascending"),E=t("Descending"),q=t("Any"),O=t("less"),D=t("Row"),j=t("New"),R=t("Updated"),N=t("Jump to page"),B=t("Reset Table"),F=t("Fullscreen"),A=t("Exit Fullscreen"),I=t("Exit Edit Mode"),M=t("Full Table"),P=t("Compact Table"),L=t("Edit Online"),z=t("Add new record in Table"),U=t('Edit<span class="pd-datatbales-btn-count"></span> in Table'),J=t("Record is valid"),K=t("Some fields have validation errors"),H=t("Some fields are required"),G=t("Detailed error summary"),Y=t("Field errors"),W=t("You have unsaved records in the table. Do you want to discard your changes or continue editing?"),X=t("Validating records"),V=t("Saving records to the system"),Z=t("Records saved to the system."),Q=t("Would you like to add more records, or preview them in the table?"),ee=t("Add more records"),te=t("Preview records"),ae=t("Your records did not save because one or more of them have errors. Fix the errors and save again to finalize your records."),ne=t("Could not save the records due to the following error: "),re=t("Your records did not save. Try saving again. If the issue persist please contact support with Support ID: "),de=t("Your records did not save. Try saving again. If the issue persist please contact support."),le=t("{PRIM_IDS} already used in this Editor Table."),ie=t(" record(s)"),se=t("Legend:"),oe=t("Valid"),ce=t("Error"),pe=t("Required"),ue=t("Error: Could not query records. Please try again."),fe=t("Error: Could not generate Excel template. Please try again."),be=t('Edit<span class="pd-datatbales-btn-count"></span> in Excel'),me=t("Exporting{COUNT} record(s) to an Excel Template"),he=t('Delete<span class="pd-datatbales-btn-count"></span>'),ve=t('Save<span class="pd-datatbales-btn-count"></span>'),ge={decimal:"",emptyTable:'<span id="pd-dtatable-no-records">'+t("No data available in table")+"</span>",info:t("Showing _START_ to _END_ of _TOTAL_ entries"),infoEmpty:t("Showing 0 to 0 of 0 entries"),infoFiltered:t("(filtered from _MAX_ total entries)"),infoPostFix:"",thousands:",",lengthMenu:t("_MENU_ Show number of entries"),loadingRecords:t("Loading..."),processing:"",search:t("Full Text Search"),zeroRecords:'<span id="pd-dtatable-no-records">'+t("No matching records found")+"</span>",paginate:{first:"«",last:"»",next:"›",previous:"‹"},aria:{orderable:t("Order by this column"),orderableReverse:t("Reverse order this column")}},$e=new marked.Renderer,ye=["year","month","int","bigint","numeric","float","double","money"],_e=["text","_text"];let xe,we;a.has("dt_query")&&$([document.documentElement,document.body]).animate({scrollTop:$("#dt-preview").offset().top},0);let ke=window.localStorage.getItem("DataTables_dtprv_"+window.location.pathname);ke&&(we=JSON.parse(ke));let Te=void 0===we||void 0===we.compact_view||we.compact_view,Ce=Ue(),Se=void 0!==we&&void 0!==we.edit_view&&we.edit_view;Se&&$(".pd-datable-instructions").css({display:"none"});let Ee=void 0!==we&&void 0!==we.editing_rows?we.editing_rows:[],qe=!1,Oe='<i aria-hidden="true" class="fas fa-spinner"></i>&nbsp;'+me.replace("{COUNT}",""),De=void 0!==we&&void 0!==we.errored_rows?we.errored_rows:{},je=void 0!==we&&void 0!==we.required_rows?we.required_rows:{},Re=void 0!==we&&void 0!==we.filled_rows?we.filled_rows:{},Ne=[],Be=[],Fe={};if(a.has("dt_query")){let e=JSON.parse(a.get("dt_query"));for(let[t,a]of Object.entries(e)){let e=$("#dtprv").find("thead").find('th[data-datastore-id="'+t+'"]');if(e.length>0){let t=$(e).index();Fe[t]=a}}}let Ae=[{className:"expanders",orderable:!1,targets:0,render:function(e,t,a,n){return Se?n.row+1:e}},{className:"checkboxes",orderable:!1,targets:1}];function Ie(e){let t=$("#dtprv").find(".pd-datatable-readmore");void 0!==e&&e&&e.length>0&&(t=$(e).find(".pd-datatable-readmore")),t.length>0&&$(t).each(function(e,t){$(t).parent("span").children(".pd-datatable-readmore-minimizer").length>0&&$(t).parent("span").children(".pd-datatable-readmore-minimizer").remove();let a=$(t).find("a.pd-datatable-readmore-expander"),n=$(t).find("a.pd-datatable-readmore-minimizer");$(t).find(".collapse").off("hidden.bs.collapse"),$(t).find(".collapse").on("hidden.bs.collapse",function(e){$(t).find('span[data-markdown="true"]').show(0),$(a).show(0)}),a.length>0&&($(a).off("click.readMore"),$(a).on("click.readMore",function(e){e.stopPropagation(),$(a).hide(0),$(t).find(".collapse").collapse("show"),$(t).find('span[data-markdown="true"]').hide(0),n.length>0&&$(n).focus()})),n.length>0&&($(n).off("click.readLess"),$(n).on("click.readLess",function(e){e.stopPropagation(),$(t).find(".collapse").collapse("hide")}))})}function Me(){if($("#dtprv").find("#dtprv-foot-main").length>0){$("#dtprv").dataTable().api().columns().every(function(e){!function(e,t){let a=$.parseHTML('<span class="dtprv-filter-col"></span>')[0];if(1==t&&(a=$.parseHTML('<input title="'+k+'" aria-label="'+k+'" id="dt-select-all" name="dt-select-all" type="checkbox"/>')[0]),t>=2){let r=$("#dtprv").find("thead").find("th").eq(t),d=$(r).attr("data-datastore-type"),l=T+" "+$(r).attr("data-schema-label"),i="",s=e.search(),o=String(s).length>0?s:"";Fe&&void 0!==Fe[t]&&(o=Fe[t]);let c='<input placeholder="'+l+'" name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" type="text" value="'+o+'" class="form-control form-control-sm" />';"year"==d?c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" data-number-type="int" type="number" min="1899" max="'+n+'" step="1" value="'+o+'" class="form-control form-control-sm" />':"month"==d?c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" data-number-type="int" type="number" min="1" max="12" step="1" value="'+o+'" class="form-control form-control-sm" />':"date"==d?c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" type="date" min="1899-01-01" value="'+o+'" class="form-control form-control-sm" />':"timestamp"==d?(i="dtprv-filter-col-deactive",c='<input tabindex="-1" name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" type="datetime-local" min="1899-01-01T00:00" value="'+o+'" class="form-control form-control-sm" />'):"int"==d||"bigint"==d?c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" placeholder="'+l+'" data-number-type="int" type="text" step="1" value="'+o+'" class="form-control form-control-sm" />':"numeric"==d||"float"==d||"double"==d?c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" placeholder="'+l+'" data-number-type="float" type="text" value="'+o+'" class="form-control form-control-sm" />':"money"==d&&(c='<input name="dtprv-filter-col-'+t+'" id="dtprv-filter-col-'+t+'" placeholder="'+l+'" data-number-type="money" type="text" value="'+o+'" class="form-control form-control-sm" />'),a=$.parseHTML('<span class="dtprv-filter-col '+i+'"><label for="dtprv-filter-col-'+t+'" class="sr-only">'+l+"</label>"+c+'<button type="submit" class="btn btn-primary btn-small"><i aria-hidden="true" class="fas fa-search"></i><span class="sr-only">'+l+"</span></button></span>")[0]}e.footer().replaceChildren(a);let d=$("#dtprv-filter-col-"+t);if(d.length>0){let t=$(d).attr("data-number-type");$(d).off("keyup.filterCol"),$(d).on("keyup.filterCol",function(a){let n=$(d).val(),l="fr"==r?".":"";13==a.keyCode&&e.search()!==n&&("int"==t&&n?n=Math.round(n.replace(" ","").replace(",",l)):"float"==t&&n?n=parseFloat(n.replace(",",l).replace(" ","")):"money"==t&&n&&(n=parseFloat(n.replace("$","").replace(" ","").replace(",",l)).toFixed(2)),$(d).val(n).focus().blur(),e.search(n).draw())})}}(this,e)});let e=$("#dtprv_wrapper").find(".dt-scroll-foot").find("#dt-select-all");e.length>0&&$(e).on("click",function(t){$(e).is(":checked")?xe.rows().select():xe.rows().deselect()})}}function Pe(e,a,i,s,o){if("display"==a){let c=e,p=!1;void 0!==o.datatables_full_text_choices&&o.datatables_full_text_choices&&(p=!0);let u=s.col-2;if(Se)return void 0===o.import_template_include||o.import_template_include?function(e,a,r,d){let l=d.datastore_type,i="pd-records_"+a+"_"+d.datastore_id,s=w[d.datastore_id];void 0!==e&&null!=e||(e="");let o="",c="",p=0,u=h.includes(r);Ee.length>0&&h.includes(r)&&(o="readonly",c="editor-input-readonly",p=-1);let f="";void 0!==s.form_attrs&&s.form_attrs&&void 0!==s.form_attrs.maxlength&&(f='maxlength="'+s.form_attrs.maxlength+'"');let b='<label class="sr-only" for="'+i+'">'+D+" "+(a+1)+" - "+s.label+"</label>",m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" '+o+f+' tabindex="'+p+'" autocomplete="off" />';if("year"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" data-number-type="int" type="number" min="1899" max="'+n+'" step="1" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"month"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" data-number-type="int" type="number" min="1" max="12" step="1" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"date"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" type="date" min="1899-01-01" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"timestamp"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" type="datetime-local" min="1899-01-01T00:00" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"int"==l||"bigint"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" data-number-type="int" type="number" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"numeric"==l||"float"==l||"double"==l?m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" data-number-type="float" type="number" '+o+f+' tabindex="'+p+'" autocomplete="off" />':"money"==l&&(m='<input class="pd-datatable-editor-input '+c+'" value="'+e+'" name='+i+'" id="'+i+'" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" data-number-type="money" type="number" '+o+f+' tabindex="'+p+'" autocomplete="off" />'),void 0!==s.select_choices&&s.select_choices){m='<select class="pd-datatable-editor-input '+c+'" name='+i+'" id="'+i+'" '+("_text"==l?"multiple":"")+' data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" '+o+' tabindex="'+p+'" autocomplete="off"><option></option>';for(let a=0;a<s.select_choices.length;a++){let n=e==s.select_choices[a][0]||Array.isArray(e)&&e.includes(s.select_choices[a][0])?"selected":"",r=s.select_choices[a][1];void 0!==d.datatables_full_text_choices&&d.datatables_full_text_choices&&(r=s.select_choices[a][0]+t(": ")+r),m+='<option value="'+s.select_choices[a][0]+'" '+n+">"+r+"</option>"}m+="</select>"}return(void 0!==d.form_snippet&&d.form_snippet.includes("textarea")||void 0!==d.markdown&&d.markdown)&&(m='<textarea class="pd-datatable-editor-input '+c+'" name='+i+'" id="'+i+'" rows="1" data-primary-key="'+u+'" data-row-index="'+a+'" data-datastore-id="'+d.datastore_id+'" '+o+f+' tabindex="'+p+'" autocomplete="off">'+e+"</textarea>"),'<form autocomplete="off">'+b+m+"<form>"}(e,s.row,u,o):"";if(null==e)return"";let f=!1;if(w&&(f=w[o.datastore_id]),void 0!==o.markdown&&o.markdown&&(e=e.replace("•","\n-").replace("\r\n•","\n-").replace("\n•","\n-").replace("\r•","\n-").replace(String.fromCharCode(8226),"\n-").replace(String.fromCharCode(183),"\n-"),e=DataTable.render.ellipsis(100,s.row,o.datastore_id,!0)(e,a,i,s)),"_text"==o.datastore_type){Array.isArray(e)||(e=e.toString().split(","));let a='<ul class="text-left">';e.forEach(function(e,n,r){let d=e;if(f&&p&&void 0!==f.select_choices&&f.select_choices)for(let a=0;a<f.select_choices.length;a++)if(e==f.select_choices[a][0]){d+=t(": ")+f.select_choices[a][1];break}a+=p?'<li><span class="pd-datatable-choice-title" title="'+d+'" aria-label="'+d+'">'+e+"</span></li>":"<li>"+e+"</li>"}),a+="</ul>",e=a}else if(f&&p&&void 0!==f.select_choices&&f.select_choices)for(let a=0;a<f.select_choices.length;a++)if(e==f.select_choices[a][0]){let n=c+t(": ")+f.select_choices[a][1];e='<span class="pd-datatable-choice-title" title="'+n+'" aria-label="'+n+'">'+e+"</span>";break}if(!0===e&&(e="TRUE"),!1===e&&(e="FALSE"),"numeric"!=o.datastore_type&&"int"!=o.datastore_type&&"bigint"!=o.datastore_type||(e="en"==r?DataTable.render.number(",",".",null,null).display(e,a,i):"fr"==r?DataTable.render.number(" ",",",null,null).display(e,a,i):DataTable.render.number(null,null,null,null).display(e,a,i)),"timestamp"==o.datastore_type&&(e.toString().includes("+0000")||(e=e.toString()+"+0000"),e=new Date(e).toLocaleString(d,{timeZone:"America/Montreal"})+" "+l),"money"==o.datastore_type&&(e.toString().includes("$")&&(e=e.toString().replace("$","")),e="en"==r?DataTable.render.number(",",".",2,"$").display(e,a,i):"fr"==r?DataTable.render.number(" ",",",2,null).display(e,a,i)+"&nbsp;$":DataTable.render.number(null,null,2,"$").display(e,a,i)),e=DataTable.render.ellipsis(100,s.row,o.datastore_id,!1)(e,a,i,s),h.includes(u)){let t=[];for(let e=0;e<h.length;e++)t.push(String(i[h[e]+2]));if(Ne.length>0)for(let a=0;a<Ne.length;a++)Ne[a].every(function(e,a){return e==t[a]})&&(e+='<sup><span class="badge pd-datatable-badge pd-datatable-badge-new"><i aria-hidden="true" class="fas fa-star"></i>&nbsp;'+j+"</span></sup>");if(Be.length>0)for(let a=0;a<Be.length;a++)Be[a].every(function(e,a){return e==t[a]})&&(e+='<sup><span class="badge pd-datatable-badge pd-datatable-badge-update"><i aria-hidden="true" class="fas fa-star"></i>&nbsp;'+R+"</span></sup>")}return e}return e}DataTable.ext.errMode=function(e,t,a){console.warn(a)},DataTable.render.ellipsis=function(e,t,a,n){return function(r,d,l,i){if("display"==d){let d=r.toString(),l=$($.parseHTML(d)).text();if(d.length<e||l.length<e)return n?marked.parse(r,{renderer:$e}):r;let i="datatableReadMore_"+t+"_"+a,s='<a class="pd-datatable-readmore-expander" href="javascript:void(0);" data-toggle="collapse" data-bs-toggle="collapse" aria-expanded="false" aria-controls="'+i+'">&#8230;</a>',o=n?marked.parse(d.substr(0,e-1)+s+"\n",{renderer:$e}):d.substr(0,e-1)+s,c=n?marked.parse(d,{renderer:$e}):d.substr(e-1);return'<div class="pd-datatable-readmore"><span data-markdown="'+n+'">'+o+'</span><span class="collapse" id="'+i+'">'+c+'<a class="pd-datatable-readmore-minimizer" href="javascript:void(0);" data-toggle="collapse" data-bs-toggle="collapse" aria-expanded="true" aria-controls="'+i+'"><small>['+O+"]</small></a><span></div>"}return r}};let Le=1;for(let e=0;e<y.length;e++)if(void 0===y[e].published_resource_computed_field||!y[e].published_resource_computed_field){let t="";void 0!==y[e].preview_class&&(t=y[e].preview_class),h.includes(e)&&(t+=" pd-datatables-primary-key-fixed "),void 0===y[e].import_template_include||y[e].import_template_include||(t+=" pd-datatables-non-editable-col "),void 0!==y[e].datatables_col_class&&(t+=" pd-datatables-"+y[e].datatables_col_class+" "),"record_created"!=y[e].datastore_id&&"record_modified"!=y[e].datastore_id||(t+=" pd-datatables-meta-col-lg "),Ae.push({name:y[e].datastore_id,className:t,searchable:!0,render:function(t,a,n,r){return Pe(t,a,n,r,y[e])}}),Le+=1}const ze=[[Le-1,"desc"]];function Ue(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}function Je(e,t){if(void 0===t)return;let a=xe.rows({selected:!0})[0].length,n=$("#dtprv_wrapper").find(".pd-datatable-btn-single");if(a>1&&$(n).each(function(e,t){$(t).addClass("disabled"),$(t).attr("disabled","disabled")}),_&&a>0){xe.buttons("tableEditorButton:name").text('<i aria-hidden="true" class="fas fa-edit"></i>&nbsp;'+U);let e=$("#dtprv_wrapper").find("span.pd-datatbales-btn-count");$(e).each(function(e,t){$(t).html("&nbsp;"+a+ie)})}else{xe.buttons("tableEditorButton:name").text('<i aria-hidden="true" class="fas fa-plus"></i>&nbsp;'+z);let e=$("#dtprv_wrapper").find("span.pd-datatbales-btn-count");$(e).each(function(e,t){$(t).html("")})}for(let a=0;a<t.length;a++){let n=$($("#dtprv").find("#dtprv-body-main").find("tr:not(.child):not(.validation-error)")[t[a]]).find("td.checkboxes").find('input[type="checkbox"]');$(n)[0].checked=e,$(n).attr("checked",e).blur()}}function Ke(e,t,a){console.warn(e),xe.processing(!1),$("#dtprv_processing").css({display:"none"}),$("#dtprv_wrapper").find("#dtprv_failure_message").remove(),$("#dtprv_wrapper").find(".dt-scroll").before('<div id="dtprv_failure_message" class="alert alert-dismissible show alert-'+a+'"><p>'+t+"</p></div>")}function He(e){Ke(e,ue,"warning")}function Ge(e){Ke(e,de,"danger")}function Ye(){$("#dtprv").css({visibility:"visible"}),$("table.dataTable").css({visibility:"visible"}),$(".dt-scroll-head").css({visibility:"visible"}),$(".dt-scroll-head").find("th.expanders").css({visibility:"visible"}),$(".dt-length").css({visibility:"visible"}),$(".dt-search").css({visibility:"visible"}),$("#dtprv-editor-button").css({visibility:"visible"}),$("#dtprv-editor-button").find("button").css({display:"flex"}),$("#dtprv_wrapper").attr("data-editable",_),$("#dtprv_wrapper").attr("data-compact-view",Te),$("#dtprv_wrapper").attr("data-edit-view",Se),$("#dtprv_wrapper").find("tr").children("th:first-of-type").css({width:"auto","min-width":"auto","max-width":"auto",padding:"8px",visibility:"visible"}),$("#dtprv_wrapper").find("tr").children("td:first-of-type").css({width:"auto","min-width":"auto","max-width":"auto",padding:"8px",visibility:"visible"})}function We(){$("#dtprv").css({visibility:"hidden"}),$(".dt-scroll-head").css({visibility:"hidden"}),$(".dt-scroll-head").find("th.expanders").css({visibility:"hidden"}),$(".dt-length").css({visibility:"hidden"}),$(".dt-search").css({visibility:"hidden"}),$("#dtprv-editor-button").css({visibility:"hidden"}),$("#dtprv-editor-button").find("button").css({display:"none"})}function Xe(){if(Se){let e=!1,t=!1,a=$("#dtprv_wrapper").find(".pd-datatable-save-btn").find("span.pd-datatbales-btn-count");for(let[e,a]of Object.entries(De))a.length>0&&(t=!0);for(let[e,a]of Object.entries(je))a.length>0&&(t=!0);let n=0;for(let[e,t]of Object.entries(Re))t.length>0&&(n+=1);0==n?(e=!1,$(a).html("")):(e=!0,$(a).html("&nbsp;"+n+ie)),t||!e?xe.buttons("saveButton:name").enable(!1):xe.buttons("saveButton:name").enable()}qe&&xe.buttons("excelEditorButton:name").enable(!1);let e=$("#dtprv_wrapper").find(".dt-buttons").find(".btn.disabled");if(e.length>0&&$(e).each(function(e,t){$(t).attr("disabled",!0)}),Se)return;let t=!1;Te||(t=!0),xe.search()&&(t=!0),10!=xe.page.len()&&(t=!0);let a=$("#dtprv").find("thead").find('th[data-datastore-id="'+we.order[0][0]+'"]').index();(we.order.length!=ze.length||"desc"!=we.order[0][1]||we.order[0][0]!=ze[0][0]&&a!=ze[0][0]||we.order[0][1]!=ze[0][1])&&(t=!0),xe.page.info().page>0&&(t=!0),xe.rows({selected:!0})[0].length>0&&(t=!0),0==Object.keys(Fe).length&&xe.columns().every(function(e){this.search()&&(t=!0)}),t?xe.buttons("resetTableButton:name").enable():xe.buttons("resetTableButton:name").enable(!1)}function Ve(){let e=[];return document.fullscreenEnabled&&(e.push({name:"fullscreenButton",text:Ce&&Ue()?'<i aria-hidden="true" class="fas fa-compress"></i>&nbsp;'+A:'<i aria-hidden="true" class="fas fa-expand"></i>&nbsp;'+F,className:"pd-datatable-btn btn-secondary pd-datatable-fullscreen-btn",action:function(e,t,a,n){let r=$("#dt-preview")[0];if(Ue())return document.exitFullscreen?(document.exitFullscreen(),Ce=!1):document.webkitExitFullscreen?(document.webkitExitFullscreen(),Ce=!1):document.mozExitFullscreen?(document.mozExitFullscreen(),Ce=!1):document.msExitFullscreen&&(document.msExitFullscreen(),Ce=!1),void t.button("fullscreenButton:name").text('<i aria-hidden="true" class="fas fa-expand"></i>&nbsp;'+F);var d;(d=r).requestFullscreen?(d.requestFullscreen(),Ce=!0):d.webkitRequestFullscreen?(d.webkitRequestFullscreen(),Ce=!0):d.mozRequestFullScreen?(d.mozRequestFullScreen(),Ce=!0):d.msRequestFullscreen&&(d.msRequestFullscreen(),Ce=!0),Ce&&t.button("fullscreenButton:name").text('<i aria-hidden="true" class="fas fa-compress"></i>&nbsp;'+A)}}),$(document).off("fullscreenchange.setButtonLabel"),$(document).on("fullscreenchange.setButtonLabel",function(e){Ce&&Ue()?($(".pd-datatable-fullscreen-btn").html('<i aria-hidden="true" class="fas fa-compress"></i>&nbsp;'+A),Ce=!0):($(".pd-datatable-fullscreen-btn").html('<i aria-hidden="true" class="fas fa-expand"></i>&nbsp;'+F),Ce=!1)})),Se?(e.push({name:"saveButton",text:'<i aria-hidden="true" class="fas fa-save"></i>&nbsp;'+ve,className:"pd-datatable-btn btn-success pd-datatable-save-btn",enabled:!1,action:function(e,t,a,n){!function(){let e={resource_id:o,method:Ee.length>0?"update":"insert",dry_run:!0,records:[]},t=$('meta[name="csrf_field_name"]').attr("content"),a=$('meta[name="'+t+'"]').attr("content");e[t]=a;let n=$("#dtprv_wrapper"),r=$(n).find("#dtprv-body-main");for(let[t,a]of Object.entries(Re))if(a.length>0){let n={},d=$(r).find("tr").eq(t);for(let e=0;e<a.length;e++)n[a[e]]=$(d).find('.pd-datatable-editor-input[data-datastore-id="'+a[e]+'"]').val();e.records.push(n)}e.records=JSON.stringify(e.records),$(n).find('.pd-datatables-editor-loader[data-action="validate"]').css({display:"flex"}),$(n).find('.pd-datatables-editor-loader[data-action="validate"]').focus(),$(n).children(".dt-scroll").css({"pointer-events":"none",visibility:"hidden"}),$(n).children(".dt-buttons").css({"pointer-events":"none",visibility:"hidden"}),et(e)}()}}),e.push({name:"exitEditButton",text:'<i aria-hidden="true" class="fas fa-door-open"></i>&nbsp;'+I,className:"pd-datatable-btn btn-warning pd-datatable-exit-edit-btn",enabled:!0,action:function(e,t,a,n){let r=!1;for(let[e,t]of Object.entries(Re))if(t.length>0){r=!0;break}r&&!window.confirm(W)||(De={},je={},Re={},We(),xe.rows().deselect(),Te=!0,Se=!1,$(".pd-datable-instructions").css({display:"block"}),we=void 0,t.state.clear(),t.clear().destroy(),dt())}}),e):(e.push({name:"tableTypeButton",text:Te?'<i aria-hidden="true" class="fa fa-table"></i>&nbsp;'+M:'<i aria-hidden="true" class="fa fa-list"></i>&nbsp;'+P,className:"pd-datatable-btn btn-info",action:function(e,t,a,n){Te?(t.button("tableTypeButton:name").text('<i aria-hidden="true" class="fa fa-table"></i>&nbsp;'+P),Te=!1,we.compact_view=!1):(t.button("tableTypeButton:name").text('<i aria-hidden="true" class="fa fa-list"></i>&nbsp;'+M),Te=!0,we.compact_view=!0),we.selected=xe.rows({selected:!0})[0],We(),t.clear().destroy(),dt()}}),e.push({name:"resetTableButton",text:'<i aria-hidden="true" class="fas fa-sync-alt"></i>&nbsp;'+B,className:"pd-datatable-btn btn-warning pd-datatable-reset-btn",enabled:!1,action:function(e,t,a,n){We(),xe.rows().deselect(),Te=!0,Se=!1,$(".pd-datable-instructions").css({display:"block"}),we=void 0,t.state.clear(),t.clear().destroy(),dt()}}),w&&e.push({name:"tableEditorButton",text:'<i aria-hidden="true" class="fas fa-plus"></i>&nbsp;'+z,className:"pd-datatable-btn pd-datatable-editor-btn btn-success",action:function(e,t,a,n){if(Ee=[],_){let e=h.map(function(e){return e+2});xe.rows({selected:!0}).eq(0).each(function(a){Ee.push(t.cells(a,e).data().toArray())})}We(),xe.rows().deselect(),Te=!1,Se=!0,$(".pd-datable-instructions").css({display:"none"}),xe.state.save(),xe.clear().destroy(),dt()}}),_&&(e.push({extend:"selected",name:"excelEditorButton",text:qe?Oe:'<i aria-hidden="true" class="fas fa-file-excel"></i>&nbsp;'+be,enabled:!qe,className:"pd-datatable-btn pd-datatable-excel-btn btn-primary",action:function(e,t,a,n){let r=h.map(function(e){return e+2}),d=t.rows({selected:!0}),l=new Object;l.resource_name=c,l[i]=s,l.key_indices=h,l["bulk-template"]=[],d.eq(0).each(function(e){l["bulk-template"].push(t.cells(e,r).data().toArray())});let o="",p=[];for(let[e,t]of Object.entries(l))if(Array.isArray(t))if("bulk-template"==e)for(let a=0;a<t.length;a++)p.push(encodeURIComponent(e)+"="+encodeURIComponent(t[a].join(",")));else p.push(encodeURIComponent(e)+"="+encodeURIComponent(t.join(",")));else p.push(encodeURIComponent(e)+"="+encodeURIComponent(t));o=p.join("&"),Oe='<i aria-hidden="true" class="fas fa-spinner"></i>&nbsp;'+me.replace("{COUNT}"," "+d[0].length),xe.buttons("excelEditorButton:name").text(Oe),xe.buttons("excelEditorButton:name").enable(!1),qe=!0,async function(e,t){return new Promise(function(a,n){let r=new XMLHttpRequest;r.responseType="blob",r.withCredentials=!0,r.onload=function(){a(r)},r.onerror=n,r.open("POST",e),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(t)}).then(function(t){let a=e.substring(e.lastIndexOf("/")+1).split("?")[0],n=document.createElement("a");return n.href=window.URL.createObjectURL(t.response),n.download=a,n.style.display="none",document.body.appendChild(n),n.click(),n.remove(),t})}(u,o).then(function(){xe.buttons("excelEditorButton:name").text('<i aria-hidden="true" class="fas fa-file-excel"></i>&nbsp;'+be);let e=$("#dtprv_wrapper").find(".pd-datatable-excel-btn").find("span.pd-datatbales-btn-count"),t=xe.rows({selected:!0})[0].length;t>0&&$(e).html("&nbsp;"+t+ie),xe.buttons("excelEditorButton:name").enable(),qe=!1}).catch(function(){Ke("DataTables error - Failed to generate Excel template",fe,"warning"),qe=!1})}}),e.push({extend:"selected",text:'<i aria-hidden="true" class="fas fa-edit"></i>&nbsp;'+L,className:"pd-datatable-btn pd-datatable-btn-single btn-success",action:function(e,t,a,n){let r=h.map(function(e){return e+2}),d=t.rows({selected:!0});d[0].length>1||d.eq(0).each(function(e){let a=t.cells(e,r).data().toArray(),n=encodeURIComponent(a.join(","));window.location=p+n})}})),e.push({extend:"selected",text:'<i aria-hidden="true" class="fas fa-trash-alt"></i>&nbsp;'+he,className:"pd-datatable-btn btn-danger",action:function(e,t,a,n){let r=$("<form></form>",{action:b,method:"post"}).append($("<input>").attr({type:"hidden",value:c,name:"resource_name"})).append($("<input>").attr({type:"hidden",value:s,name:i})).append($("<input>").attr({type:"hidden",value:h,name:"key_indices"})),d=h.map(function(e){return e+2});t.rows({selected:!0}).eq(0).each(function(e){r.append($("<input>").attr({type:"hidden",value:t.cells(e,d).data().toArray(),name:"select-delete"}))}),r.appendTo("body").submit()}}),e)}function Ze(e,t){let a=$("#dtprv_wrapper").find("#dtprv-body-main").find("tr").eq(e),n=$(a).find("td").length;if($(a).next(".validation-error").remove(),void 0!==t.message&&t.message&&t.message.length>0&&$(a).after('<tr class="validation-error"><td class="expanders">'+(parseInt(e)+1)+'</td><td colspan="'+(n-1)+'"><i aria-hidden="true" class="fas fa-exclamation-triangle"></i>&nbsp;'+t.message+"</td></tr>"),void 0!==t.data&&t.data)for(let[n,r]of Object.entries(t.data)){let t=$(a).find('.pd-datatable-editor-input[data-datastore-id="'+n+'"]');t.length>0&&($(t).parent().find(".validation-error").remove(),$(t).parent().append('<div class="validation-error"><i aria-hidden="true" class="fas fa-exclamation-triangle"></i>&nbsp;'+r.join(". ")+"</div>"),$(t).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),De[e].includes(n)||De[e].push(n))}$(a).find("td.expanders").css({"background-color":"#"+x.errored.bgColor,color:"#"+x.errored.fgColor,cursor:"pointer"}).attr("title",K).attr("role","button").attr("tabindex",0)}function Qe(e,t){let a=$("#dtprv_wrapper");if($(a).find("#dtprv_failure_message").remove(),$(a).find(".dt-scroll-body")[0].scrollTo(0,0),e.responseJSON)if(e.responseJSON.success)if(t.dry_run)$(a).find('.pd-datatables-editor-loader[data-action="save"]').css({display:"flex"}),$(a).find('.pd-datatables-editor-loader[data-action="save"]').focus(),$(a).children(".dt-scroll").css({"pointer-events":"none",visibility:"hidden"}),$(a).children(".dt-buttons").css({"pointer-events":"none",visibility:"hidden"}),t.dry_run=!1,et(t);else{if(Ee.length>0?($(a).find("#pd-datatables-editor-complete-sub-copy").css({display:"none"}),$(a).find("#pd-datatables-editor-complete-more").css({display:"none"})):($(a).find("#pd-datatables-editor-complete-sub-copy").css({display:"inline"}),$(a).find("#pd-datatables-editor-complete-more").css({display:"inline-block"})),$(a).find('.pd-datatables-editor-loader[data-action="complete"]').css({display:"flex"}),$(a).find('.pd-datatables-editor-loader[data-action="complete"]').focus(),$(a).children(".dt-scroll").css({"pointer-events":"none",visibility:"hidden"}),$(a).children(".dt-buttons").css({"pointer-events":"none",visibility:"hidden"}),void 0!==e.responseJSON.result&&e.responseJSON.result){Ne=[],Be=[];let t=e.responseJSON.result;for(let[e,a]of Object.entries(t)){let e=[];for(let t=0;t<h.length;t++)e.push(Object.values(a.records[0])[h[t]]);Ee.length>0?Be.push(e):Ne.push(e)}}Ee=[],De={},je={},Re={}}else{let t=e.responseJSON.error;if(void 0!==t.message)n="DataTables error - Could not save data: "+t.message,r=t.message,Ke(n,ne+r,"danger");else{!function(e){Ke(e,ae,"danger")}("DataTables error - Could not save data: one or more records have errors"),$(a).find(".pd-datable-error-summary").remove();let e='<div class="pd-datable-error-summary"><details><summary>'+G+"</summary>",n=Object.entries(Re);for(let[a,r]of Object.entries(t)){let t=parseInt(a.replace("row_","")),d=n[t];if(void 0!==d&&d.length>0){if(t=d[0],Ze(t,r),e+='<div class="pd-datable-error-summary-item"><strong class="pd-datable-error-summary-row-title">'+D+" "+(parseInt(t)+1)+"</strong>",void 0!==r.message&&r.message&&r.message.length>0&&(e+="<em>"+r.message+"</em><br/>"),void 0!==r.data&&r.data){e+="<strong>"+Y+"</strong><ul>";for(let[a,n]of Object.entries(r.data)){e+='<li><em><a href="javascript:void(0);" class="pd-datable-error-field-link" data-row-index="'+t+'" data-field-id="'+a+'">'+w[a].label+"</a></em><ul>";for(let t=0;t<n.length;t++)e+="<li>"+n[t]+"</li>";e+="</ul></li>"}e+="</ul>"}e+="</div>"}else console.warn("DataTables error - Could not locate record in the table...ignoring...")}e+="</details></div>",$(a).find(".dt-scroll").before(e);let r=$(a).find(".pd-datable-error-field-link");r.length>0&&$(r).each(function(e,t){$(t).off("click.GoToError"),$(t).on("click.GoToError",function(e){let n=$(t).attr("data-row-index"),r=$(t).attr("data-field-id");$(a).find("#dtprv-body-main").find("tr").eq(n).find("td").find('[data-datastore-id="'+r+'"]').focus()})})}}else if(e.responseText&&e.responseText.length>0){let t=e.responseText.match("<span>Support ID: <em>([0-9]+)</em></span>");Array.isArray(t)&&t.length>=2?(t=t[1],function(e,t){Ke(e,re+"<pre>"+t+"</pre>","danger")}("DataTables error - Could not save data",t)):Ge("DataTables error - Could not save data")}else Ge("DataTables error - Could not save data");var n,r;Xe()}function et(e){$.ajax({url:f,type:"POST",dataType:"JSON",data:e,complete:function(t){setTimeout(function(){$("#dtprv_wrapper").children(".dt-scroll").css({"pointer-events":"all",visibility:"visible"}),$("#dtprv_wrapper").children(".dt-buttons").css({"pointer-events":"all",visibility:"visible"}),$("#dtprv_wrapper").find(".pd-datatables-editor-loader").css({display:"none"}),Qe(t,e)},1760)}})}function tt(e){Ee=[],De={},je={},Re={},We(),xe.rows().deselect(),Te=!e,Se=e,we=void 0,xe.state.clear(),xe.clear().destroy(),dt()}function at(){$('th[class*="dt-orderable"]').removeClass("dt-orderable").removeClass("dt-orderable-asc").removeClass("dt-ordering-asc").removeClass("dt-orderable-desc").removeClass("dt-ordering-desc"),Xe();let e=$("#dtprv_wrapper"),t=$(e).find(".dt-scroll"),a=$(e).find("#dtprv-body-main"),n=$(a).find("td.expanders"),r=$(a).find(".pd-datatable-editor-input");t.length>0&&($(e).find("#pd-datatables-editor-legend").remove(),$(t).after('<div id="pd-datatables-editor-legend"><strong>'+se+'</strong>&nbsp;<span class="pd-datatables-legend-success"><em>'+oe+'</em></span>&nbsp;&nbsp;<span class="pd-datatables-legend-required"><em>'+pe+'</em></span>&nbsp;&nbsp;<span class="pd-datatables-legend-error"><em>'+ce+"</em></span></div>")),n.length>0&&$(n).each(function(e,t){$(t).off("click.GoToError"),$(t).off("keyup.GoToError"),$(t).on("click.GoToError",function(t){void 0!==De[e]&&De[e].length>0?$(a).find("tr").eq(e).find("td").find('[data-datastore-id="'+De[e][0]+'"]').focus():void 0!==je[e]&&je[e].length>0&&$(a).find("tr").eq(e).find("td").find('[data-datastore-id="'+je[e][0]+'"]').focus()}),$(t).on("keyup.GoToError",function(t){13==t.keyCode&&(void 0!==De[e]&&De[e].length>0?$(a).find("tr").eq(e).find("td").find('[data-datastore-id="'+De[e][0]+'"]').focus():void 0!==je[e]&&je[e].length>0&&$(a).find("tr").eq(e).find("td").find('[data-datastore-id="'+je[e][0]+'"]').focus())})}),$(r).each(function(e,t){$(t).is("select")&&$(t).select2({"datastore-id":$(t).attr("data-datastore-id"),"row-index":$(t).attr("data-row-index"),allowClear:!0})}),$(r).each(function(e,t){$(t).hasClass("select2-container")||($(t).is("textarea")&&($(t).off("keyup.ResizeField"),$(t).on("keyup.ResizeField",function(e){$(t).css({height:"auto"}),$(t).css({height:this.scrollHeight+"px"})})),$(t).off("change.EDITOR"),$(t).on("change.EDITOR",function(e){!function(e){let t=$("#dtprv_wrapper"),a=$(t).find("#dtprv-body-main"),n=$(e).attr("data-datastore-id"),r=w[n],d=$(e).attr("data-row-index"),l=$(a).find("tr").eq(d),i=$(l).find(".pd-datatable-editor-input"),s=$(e).prev(".select2-container"),o=$(e).val();if($(e).parent().find(".validation-error").remove(),void 0===De[d]&&(De[d]=[]),void 0===je[d]&&(je[d]=[]),void 0===Re[d]&&(Re[d]=[]),void 0!==o&&o.length>0&&r.is_invalid(o,d)?($(e).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),s.length>0&&$(s).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),De[d].includes(n)||De[d].push(n)):(void 0===o||0==o.length?($(e).css({"box-shadow":"0 0 1px 1px #d0d0d0 inset"}),s.length>0&&$(s).css({"box-shadow":"0 0 1px 1px #d0d0d0 inset"})):($(e).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"}),s.length>0&&$(s).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"})),De[d]=De[d].filter(function(e){return e!=n})),$(i).each(function(e,t){if($(t).hasClass("select2-container"))return;let a,r=$(t).attr("data-datastore-id"),l=w[r],i=$(t).prev(".select2-container");void 0!==l.form_attrs&&l.form_attrs&&void 0!==l.form_attrs.cascading_select_field&&(a=l.form_attrs.cascading_select_field);let s=$(t).val();void 0!==a&&a==n&&($(t).find("option").each(function(e,t){let a=$(t).attr("value");a&&a!=s&&!a.startsWith(o)?$(t).attr("disabled",!0):$(t).attr("disabled",null)}),$(t).select2({"datastore-id":r,"row-index":d,allowClear:!0}),i=$(t).prev(".select2-container")),void 0!==s&&s.length>0&&l.is_invalid(s,d)?($(t).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),i.length>0&&$(i).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}).blur(),De[d].includes(r)||De[d].push(r)):!l.is_required(s,d)||void 0!==s&&0!=s.length?(void 0===s||0==s.length?($(t).css({"box-shadow":"0 0 1px 1px #d0d0d0 inset"}),i.length>0&&$(i).css({"box-shadow":"0 0 1px 1px #d0d0d0 inset"})):($(t).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"}),i.length>0&&$(i).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"})),De[d]=De[d].filter(function(e){return e!=r}),je[d]=je[d].filter(function(e){return e!=r})):(De[d].includes(r)||($(t).css({"box-shadow":"0 0 2px 2px #"+x.required.bgColor+" inset"}),i.length>0&&$(i).css({"box-shadow":"0 0 2px 2px #"+x.required.bgColor+" inset"})),je[d].includes(r)||je[d].push(r)),void 0!==s&&s.length>0?Re[d].includes(r)||Re[d].push(r):Re[d]=Re[d].filter(function(e){return e!=r})}),0==Re[d].length)De[d]=[],je[d]=[],$(i).each(function(e,t){$(t).css({"box-shadow":"0 0 1px 1px #d0d0d0 inset"})});else if("true"==$(e).attr("data-primary-key")){let e=[],t=1==h.length?0:1;for(let a=0;a<h.length;a++)e.push($(i).eq(h[a]+t).val());for(let[n,r]of Object.entries(Re)){if(n==d)continue;let r=[],i=[],s=[],o=le;for(let e=0;e<h.length;e++){let d=$(a).find("tr").eq(n).find(".pd-datatable-editor-input").eq(h[e]+t);void 0!==d.val()&&d.val().length>0&&(r.push(d.val()),i.push(d.attr("data-datastore-id")))}if(r.length==h.length)if(e.every(function(e){return r.includes(e)}))for(let e=0;e<i.length;e++){let t=$(l).find('.pd-datatable-editor-input[data-datastore-id="'+i[e]+'"]'),a=$(t).prev(".select2-container");$(t).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),a.length>0&&$(a).css({"box-shadow":"0 0 2px 2px #"+x.errored.bgColor+" inset"}),De[d].includes(i[e])||De[d].push(i[e]);let n=w[i[e]];s.push(n.label),Ze(d,{message:o.replace("{PRIM_IDS}",s.join(", "))})}else{for(let e=0;e<i.length;e++){let t=$(l).find('.pd-datatable-editor-input[data-datastore-id="'+i[e]+'"]'),a=$(t).prev(".select2-container");$(t).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"}),a.length>0&&$(a).css({"box-shadow":"0 0 2px 2px #"+x.success.bgColor+" inset"}),De[d]=De[d].filter(function(t){return t!=i[e]})}$(l).next(".validation-error").remove()}}}De[d].length>0?$(l).find("td.expanders").css({"background-color":"#"+x.errored.bgColor,color:"#"+x.errored.fgColor,cursor:"pointer"}).attr("title",K).attr("role","button").attr("tabindex",0):je[d].length>0?$(l).find("td.expanders").css({"background-color":"#"+x.required.bgColor,color:"#"+x.required.fgColor,cursor:"pointer"}).attr("title",H).attr("role","button").attr("tabindex",0):0==Re[d].length?($(l).find("td.expanders").css({"background-color":"#555555",color:"white",cursor:"default"}).attr("title",null).attr("role",null).attr("tabindex",null),$(l).next(".validation-error").remove()):$(l).find("td.expanders").css({"background-color":"#"+x.success.bgColor,color:"#"+x.success.fgColor,cursor:"default"}).attr("title",J).attr("role",null).attr("tabindex",null),Xe()}(t)}),Ee.length>0&&$(t).val().length>0&&$(t).trigger("change"))})}function nt(e){$("#dtprv_wrapper").find("#dtprv_failure_message").remove(),Ye(),Se?at():(function(){let e=$("#dtprv").find("td.expanders");e.length>0&&($(e).each(function(e,t){$(t).attr("role","button"),$(t).attr("aria-controls","dtprv-child-data-row-"+e),$(t).parent().next().hasClass("child")?$(t).attr("aria-expanded",!0):$(t).attr("aria-expanded",!1),$(t).off("click.Accessible"),$(t).on("click.Accessible",function(e){setTimeout(function(){$(t).parent().next().hasClass("child")?($(t).attr("aria-expanded",!0),Ie($(t).parent().next())):$(t).attr("aria-expanded",!1)},250)})}),xe.off("childRow.Accessible"),xe.on("childRow.Accessible",function(t,a,n){if(a){let t=n.index();$(e).eq(t).attr("aria-expanded",!0),$(e).eq(t).attr("aria-controls","dtprv-child-data-row-"+t),$(e).eq(t).parent().next().attr("id","dtprv-child-data-row-"+t),Ie($(e).eq(t).parent().next())}}))}(),function(){let e=$("#dtprv").find("td.checkboxes").find('input[type="checkbox"]');e.length>0&&$(e).each(function(e,t){$(t).off("click.preventSelect"),$(t).on("click.preventSelect",function(e){e.stopPropagation()}),$(t).off("change.rowSelect"),$(t).on("change.rowSelect",function(a){a.stopPropagation(),$(t).is(":checked")?xe.row(":eq("+e+")").select():xe.row(":eq("+e+")").deselect()})})}(),function(){let e=$("#dtprv_wrapper").find(".dt-paging");if(e.length>0){$("#dtprv_wrapper").find(".dt-jump-to-page").remove();let t=xe.page.info(),a='<div class="dt-jump-to-page"><label for="dt-jump-to-page">'+N+'</label><input aria-controls="dtprv" class"form-control form-control-sm" type="number" id="dt-jump-to-page" name="dt-jump-to-page" value="'+(t.page+1)+'" min="1" max="'+t.pages+'" /></div>';$(e).after(a);let n=$("#dtprv_wrapper").find(".dt-jump-to-page").find("input");n.length>0&&($(n).off("change.setPage"),$(n).on("change.setPage",function(e){let t=parseInt($(n).val());isNaN(t)&&!Number.isInteger(t)?t=0:t>=1&&(t-=1),xe.page(t).draw(!1)}))}}(),function(){let e=$("#dtprv_wrapper").find("#dtprv_info");if(e.length>0){$("#dtprv_wrapper").find(".dt-sorting-info").remove();let t=xe.order(),a='<span class="info-label">'+C+"</span>";if(t.length>0){a+="<div>";for(let e=0;e<t.length;e++){let n=xe.column(t[e][0]),r=n.header().textContent,d=$("#dtprv").find("thead").find("th").eq(n.index()).attr("data-datastore-type");a+="<span><em>"+r;let l="fas fa-sort-amount-down",i="fas fa-sort-amount-up";ye.includes(d)?(l="fas fa-sort-numeric-down-alt",i="fas fa-sort-numeric-up-alt"):_e.includes(d)&&(l="fas fa-sort-alpha-down-alt",i="fas fa-sort-alpha-up-alt"),"asc"==t[e][1]?a+='<sup><i title="'+S+'" aria-label="'+S+'" class="'+i+'"></i></sup>':"desc"==t[e][1]?a+='<sup><i title="'+E+'" aria-label="'+E+'" class="'+l+'"></i></sup>':a+='<sup><i title="'+q+'" aria-label="'+q+'" class="fas fa-random"></i></sup>',a+="</em></span>"}a+="</div>"}let n='<div class="dt-sorting-info">'+a+"</div>";$(e).after(n)}}(),function(){if($("#dtprv").find(".ref-link").remove(),$.isEmptyObject(v))return;let e={};for(let[t,a]of Object.entries(v)){e[t]={};for(let[n,r]of Object.entries(a)){let a=$("#dtprv").find("thead").find('th[data-datastore-id="'+n+'"]');if(a.length>0){let d=$(a).index()+1,l=$("#dtprv").find("#dtprv-body-main").find("td:nth-child("+d+")");l.length>0&&$(l).each(function(a,d){$(d).attr("data-datastore-id",n);let l=$(d).parent("tr");if(l.length>0){let a=$(l).index(),i=$(d).clone();$(i).find("sup").remove();let s=$(i).text();void 0===e[t][a]&&(e[t][a]={this_keys:[],dt_query:{}}),e[t][a].this_keys.push(n),e[t][a].dt_query[r]=s}})}}}let t=$("#dtprv").find("#dtprv-body-main").find("tr:not(.child)");t.length>0&&$(t).each(function(t,a){for(let[n,r]of Object.entries(e)){if(void 0===r[t])continue;let e=g[n];for(e+="?dt_query="+encodeURIComponent(JSON.stringify(r[t].dt_query)),_i=0;_i<r[t].this_keys.length;_i++){let n=$(a).find('td[data-datastore-id="'+r[t].this_keys[_i]+'"]');n.length>0&&$(n).append('<sup class="ref-link pd-datatable-ref-link"><small><a target="_blank" href="'+e+'"><i class="fas fa-external-link-alt"></i></a></small></sup>')}}})}(),Xe(),Ie(),function(){let e=$(xe.table().body());if(e.unhighlight(),xe.rows({filter:"applied"}).data().length){xe.columns().every(function(e){let t=this;Fe&&void 0!==Fe[e]&&t.search(Fe[e]),t.nodes().flatten().to$().unhighlight({className:"column_highlight"});let a=String(t.search()),n=a.trim(),d=$(".dt-scroll-head").find("th").eq(t.index()).attr("data-datastore-type");a&&("numeric"==d||"float"==d||"double"==d||"int"==d||"bigint"==d?n="en"==r?DataTable.render.number(",",".",null,null).display(n,null,null):"fr"==r?DataTable.render.number(" ",",",null,null).display(n,null,null):DataTable.render.number(null,null,null,null).display(n,null,null):"money"==d&&(n.toString().includes("$")&&(n=n.toString().replace("$","")),n="en"==r?DataTable.render.number(",",".",2,"$").display(n,null,null):"fr"==r?DataTable.render.number(" ",",",2,null).display(n,null,null)+" $":DataTable.render.number(null,null,2,"$").display(n,null,null))),t.nodes().flatten().to$().highlight(n.split(/\s+/),{className:"column_highlight"})});let t=String(xe.search());e.highlight(t.trim().split(/\s+/))}}(),function(){let e=$("#dtprv_wrapper").find(".dt-scroll-body");0==xe.rows()[0].length?$(e).addClass("pd-datatable-body-main-no-records"):$(e).removeClass("pd-datatable-body-main-no-records")}())}function rt(){Ye(),function(){$("#dtprv_wrapper").prepend('<div data-action="complete" class="pd-datatables-editor-loader"><div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 214 214" class="pd-check-circle"><g fill="none" stroke="currentColor" stroke-width="2"><circle class="semi-transparent" fill="currentColor" opacity="0.15" cx="107" cy="107" r="72" ></circle><circle class="colored" fill="currentColor" cx="107" cy="107" r="72" opacity="0.8" ></circle> <polyline stroke="#fff" stroke-width="10" points="73.5,107.8 93.7,127.9 142.2,79.4" style="stroke-dasharray: 50%, 50%; stroke-dashoffset: 100%" /></g></svg></div><div><p><strong class="text-success">'+Z+'</strong><br/><span id="pd-datatables-editor-complete-sub-copy">'+Q+'</span></p></div><div><button id="pd-datatables-editor-complete-more" class="btn btn-success"><i aria-hidden="true" class="fas fa-plus"></i>&nbsp;'+ee+'</button><button id="pd-datatables-editor-complete-preview" class="btn btn-primary"><i aria-hidden="true" class="fas fa-table"></i>&nbsp;'+te+"</button></div></div>"),$("#dtprv_wrapper").prepend('<div data-action="save" class="pd-datatables-editor-loader"><div><p><strong>'+V+'</strong></p></div><div id="loader-saving"></div></div>'),$("#dtprv_wrapper").prepend('<div data-action="validate" class="pd-datatables-editor-loader"><div><p><strong>'+X+'</strong></p></div><div id="loader-validating"></div></div>');let e=$("#dtprv_wrapper").find("#pd-datatables-editor-complete-more"),t=$("#dtprv_wrapper").find("#pd-datatables-editor-complete-preview");e.length>0&&($(e).off("click.AddMore"),$(e).on("click.AddMore",function(e){tt(!0)})),t.length>0&&($(t).off("click.AddMore"),$(t).on("click.AddMore",function(e){tt(!1)}))}(),Se||(Me(),Ie(),void 0!==we&&void 0!==we.selected&&(xe.rows(we.selected).select(),Je(!0,we.selected)),Xe(),Te||xe.columns.adjust(),xe.off("select.CheckBoxes"),xe.off("deselect.CheckBoxes"),xe.on("select.CheckBoxes",function(e,t,a,n){Je(!0,n),Xe(),xe.rows({selected:!0})[0].length>0?xe.buttons("resetTableButton:name").enable():xe.buttons("resetTableButton:name").enable(!1),qe&&xe.buttons("excelEditorButton:name").enable(!1)}).on("deselect.CheckBoxes",function(e,t,a,n){Je(!1,n),xe.rows({selected:!0})[0].length>0?xe.buttons("resetTableButton:name").enable():xe.buttons("resetTableButton:name").enable(!1),qe&&xe.buttons("excelEditorButton:name").enable(!1)}),$(".pd-datable-instructions").css({display:"block"}),function(){let e=Te?0:1;e=Se?2:e,$(document).off("keyup.KeyTable"),$(document).on("keyup.KeyTable",function(t){t.altKey&&75==t.keyCode&&(t.stopPropagation(),xe.cell(":eq("+e+")").focus(),$(".dt-scroll-body")[0].scrollTop=0)}),xe.off("key.KeyTable"),xe.off("key-focus.KeyTable"),xe.off("focus.KeyTable"),Se?(xe.on("key-focus.KeyTable",function(e,t,a,n){$("input",a.node()).focus()}),xe.on("focus.KeyTable","td input",function(){$(this).select()})):xe.on("key.KeyTable",function(e,t,a,n,r){let d=n[0][0].row;if(32==a&&(e.preventDefault(),r.preventDefault(),xe.rows({selected:!0})[0].includes(d)?xe.row(d).deselect():xe.row(d).select()),69==a&&(e.preventDefault(),r.preventDefault(),Te)){let e=$("#dtprv-body-main").find("tr").eq(d),t=xe.row(e);$(e).hasClass("dtr-expanded")?(t.child.hide(),$(e).removeClass("dtr-expanded"),$(e).find("td.expanders").attr("aria-expanded",!1)):(xe.settings()[0].responsive._detailsDisplay(t,!1),$(e).find("td.expanders").attr("aria-expanded",!0))}})}()),Se&&(xe.columns.adjust(),$(".pd-datable-instructions").css({display:"none"}))}function dt(){let e={columns:Te?":not(.dtr-hidden)":":not(.dtr-hidden):not(.expanders)"},t={style:"multi",selector:"td:not(:first-child)"},a={return:!0};Se&&(e=!1,t=!1,a=!1),xe=$("#dtprv").DataTable({paging:!Se,serverSide:!0,processing:!0,responsive:Te,autoWidth:!0,stateSave:!0,scrollX:!Te,scrollY:400,scrollResize:!0,scrollCollapse:!1,deferRender:!0,keys:e,pageLength:Se?-1:10,select:t,search:a,searching:!Se,searchHighlight:!1,order:sortOrder,columns:Ae,dom:"Blfrtip",language:ge,ajax:{url:m,type:"POST",data:function(e){if(!Se&&Object.keys(Fe).length>0)for(let[t,a]of Object.entries(Fe))e.columns[t].search.value=a;if(Se&&Ee.length>0){let t=h.map(function(e){return e+2}),a=[];for(let n=0;n<Ee.length;n++)for(let r=0;r<Ee[n].length;r++)Array.isArray(e.columns[t[r]].search.value)||(e.columns[t[r]].search.value=[]),e.columns[t[r]].search.value.includes(Ee[n][r])||e.columns[t[r]].search.value.push(Ee[n][r]),a.includes(r)||a.push(r);for(let n=0;n<a.length;n++)e.columns[t[n]].search.value=JSON.stringify(e.columns[t[n]].search.value)}e.is_edit_mode=Se},complete:function(e){e.responseJSON&&e.responseJSON.aaData||He("DataTables error - "+e.status+": "+e.statusText)}},initComplete:rt,drawCallback:nt,stateSaveParams:function(e,t){t.selected=this.api().rows({selected:!0})[0],t.compact_view=Te,t.edit_view=Se,t.editing_rows=Ee;let a=void 0!==we?we.selected:t.selected;we=t,we.selected=a,we.edit_view=Se,we.editing_rows=Ee},stateLoadParams:function(e,t){let a=void 0!==we?we.selected:t.selected;we=t,we.selected=a},buttons:Ve()})}sortOrder=ze,window.onbeforeunload=function(){let e=!1;for(let[t,a]of Object.entries(Re))if(a.length>0){e=!0;break}if(e)return W},dt()}this.ckan.module("pd-datatables",function(e){return{options:{locale:"en",locale_string:"en-CA",timezone_string:"EST",csrf_name:null,csrf_value:null,resource_id:null,resource_name:null,edit_single_uri:null,edit_records_uri:null,upsert_records_uri:null,delete_records_uri:null,ajax_uri:null,table_styles:null,primary_keys:null,foreign_keys:null,foreign_links:null,chromo_fields:null,is_editable:!1},initialize:function(){load_pd_datatable(this)}}});