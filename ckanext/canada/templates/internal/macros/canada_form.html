{# vim: set filetype=jinja sw=2 sts=2: #}
{% import 'macros/form.html' as form %}

{% macro formfield(id, lang, field, data, errors, client_lang='eng') %}
  {% set kwargs = {
    'label': field.label[client_lang],
    'placeholder': field.example if lang != 'fra' else '', # FIXME
    'value': data[id],
    'error': errors[id],
    'id': 'field-' + id,
    'classes': ['control-medium'],
    } %}

  {% if lang %}
    {% do kwargs.update({'label': kwargs.label + ' ' + lang|upper}) %}
  {% endif %}

  {% if id in ('id', 'language', 'license_id', 'author_email', 'author',
               'department_number') %}
    {# None of these fields are required for data entry #}
  {% elif id == 'name' %}
    {% do kwargs.update({
      'prepend': '/data/dataset/',
      'attrs': {'data-module': 'slug-preview-slug',
                'data-module-prefix': 'data.gc.ca/data/dataset/',
                'data-module-placeholder': '<dataset>',}, 
      }) %}
    {{ form.prepend(id, **kwargs) }}
  {% elif id in ('notes', 'notes_fra') %}
    {{ form.markdown(id, **kwargs) }}
  {% elif field.choices %}
    {% do kwargs.update({'options':[], 'selected':data[id]}) %}
    {# kwargs form.select doesn't support #}
    {% do kwargs.pop('value') %}
    {% do kwargs.pop('placeholder') %}
    {% for c in field.choices %}
      {% do kwargs.options.append({
        'value': c.eng + ' | ' + c.fra if c.eng != c.fra else c.eng}) %}
    {% endfor %}
    {{ form.select(id, **kwargs) }}
  {% elif id in ('subject', 'topic_category', 'tags') %}
    {% do kwargs.update({
      'value': data[id + '_string'],
      'classes': ['control-full'],
      'attrs': {'data-module': 'autocomplete',
                'data-module-tags': '',
                'data-module-source': '/api/2/util/tag/autocomplete?incomplete=?'},
      }) %}
    {{ form.input(id, **kwargs) }}
  {% else %}
    {{ form.input(id, **kwargs) }}
  {% endif %}
{% endmacro %}
