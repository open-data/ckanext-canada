dataset_type: grants
target_dataset: grants
title: Proactive Publication - Grants and Contributions
shortname: Grants and Contributions
notes: Access, upload and modify the Grants and Contributions reports for your organization

template_version: 3
template_updated: 2025-12-01  # last qa confirmed: 2025-12-01

template_warning:
  en: The template has been updated. Please download the latest version.
  fr: Le modèle a été mis à jour. Veuillez télécharger la dernière version.

portal_type: info
collection: pd

resources:
- title: Proactive Publication - Grants and Contributions
  resource_name: grants

  published_resource_id: 1d15a62f-5656-49ad-8c88-f40ce689d831

  create_form: true
  edit_form: true
  fields:

  # 3.1 Reference Number
  - datastore_id: ref_number
    label:
      en: Reference Number
      fr: Numéro de référence
    description:
      en: |
        The Reference number is populated by departments. It is a unique reference number given to each entry. Having a unique identifier for each item will allow departments to locate a specific item in the registry should they need to modify or delete.

        Controlled format; This field is populated in the following format DDD-YYYY-YYYY-QX-XXXXX
         1. DDD represents the department number – Use the same three-digit number as the ‘Departmental Identifier’, which is the department number per the Chart of Accounts list of departments. Ensure you are reviewing the most current year: https://www.tpsgc-pwgsc.gc.ca/recgen/pceaf-gwcoa/2425/txt/rg-3-num-eng.html
         2. YYYY-YYYY represents the fiscal year
         3. QX represents the fiscal quarter
         4. XXXXX represents the unique number assigned by the department for each entry.

        For example, entries in the 2018-2019 Q1 fiscal year should be assigned numbers as follows: 001-2018-2019-Q1-00001, 001-2018-2019-Q1-00002, 001-2018-2019-Q1-00003, etc.'
      fr: |
        Ce champ est rempli par l’utilisateur. L’identificateur de projet ministériel permet aux ministères d’identifier rapidement les rapports produits dans leur propre système. Les ministères devraient utiliser un chiffre qui est logique pour le ministère. Ces renseignements seront publiés dans le cadre du rapport.

        Format contrôlé; Ce champ est rempli au format suivant: DDD-YYYY-YYYY-QX-XXXXX
         1.	DDD représente le numéro du ministère - Utilisez le même numéro à trois chiffres que l’«Identificateur ministériel», qui est le numéro de ministère selon la liste du plan comptable des ministères. Assurez-vous de consulter l’année la plus récente : https://www.tpsgc-pwgsc.gc.ca/recgen/pceaf-gwcoa/2425/txt/rg-3-num-fra.html
         2.	AAAA-AAAA représente l'année fiscale
         3.	QX représente le trimestre fiscal
         4.	XXXXX représente le numéro unique attribué par le département pour chaque entrée.

        Par exemple, les numéros de l'exercice 2018-2019 du T1 devraient recevoir les numéros suivants: 001-2018-2019-Q1-00001, 001-2018-2019-Q1-00002, 001-2018-2019-Q1-00003, etc.'
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-lg
    js_error_eval: 'VALUE.length > 0 && VALUE.includes(",")'

  # 3.2 Amendment Number (New Field)
  - datastore_id: amendment_number
    label:
      en: Amendment Number
      fr: Numéro de modification
    description:
      en: >
        This field is populated by departments and identifies that an amendment is
        occurring to original information. Use 0 for original records.
        The first amendment after the original agreement should be identified as 1, then 2, etc.
        Agreement terminations should be identified as another amendment number and report
        'termination' in the 'Additional information' column.
      fr: >
        Ce champ est rempli par les ministères et indique qu'une modification est apportée
        aux renseignements originaux. Utiliser 0 pour les enregistrements originaux. La
        première modification après l'accord initial doit être identifiée comme numéro 1,
        puis 2, etc. Les résiliations d'accord doivent être identifiées comme un autre numéro
        de modification et indiquer 'résiliation' dans la colonne 'Renseignements supplémentaires'.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    format_type:
      en: Numeric only
      fr: Numérique uniquement
    datastore_type: int
    datatables_col_class: col-sm pd-datatables-primary-key-offset-lg

  # 3.3 Amendment Date (New Field)
  - datastore_id: amendment_date
    label:
      en: Amendment Date
      fr: Date de modification
    description:
      en: This field is populated by departments and indicates the date on which an amendment (or amendments) took place. If the amendment number is not zero, this field is required.
      fr: Ce champ est rempli par les ministères et indique la date à laquelle une modification (ou des modifications) a été apportée. Vous devez remplir ce champ si le numéro de la modification indique un autre chiffre que 0.
    obligation:
      en: Mandatory if amendment number set
      fr: Obligatoire si le numéro de modification est défini
    format_type:
      en: Date (Please format the date as YYYY-MM-DD)
      fr: "Date (Veuillez utiliser le format de date suivant : AAAA-MM-JJ)"
    datastore_type: date
    excel_required_formula: AND(NOT(ISBLANK({amendment_number})),{amendment_number}<>0)
    js_required_eval: '{{amendment_number}}.length > 0 && {{amendment_number}} != 0'
    form_snippet: scheming/form_snippets/date.html

  # 3.4 Agreement Type (Formerly “Type”- 3.16)
  - datastore_id: agreement_type
    label:
      en: Agreement Type
      fr: Type d’entente
    description:
      en: This field is populated by departments and indicates whether the agreement signed is a grant, contribution or other transfer payment.
      fr: Ce champ est rempli par les ministères et indique si l'entente signée vise une subvention, une contribution ou un autre paiement de transfert.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    format_type:
      en: Controlled List
      fr: Liste contrôlée
    datastore_type: text
    excel_required_formula: 'VALUE({agreement_start_date})>=DATE(2018,4,1)'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01")'
    choices:
      G:
        en: Grant
        fr: subvention
      C:
        en: Contribution
        fr: contribution
      O:
        en: Other transfer payment
        fr: autre

  # 3.5 Recipient Type (New field)
  - datastore_id: recipient_type
    label:
      en: Recipient Type
      fr: Type de bénéficiaire
    description:
      en: The recipient type helps identify who is receiving the money.
      fr: Le type de bénéficiaire permet d'identifier qui reçoit l'argent.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Controlled List
      fr: Liste contrôlée
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01")'
    datastore_type: text
    choices:
      F:
        en: For-profit organizations
        fr: organisme à but lucratif
      N:
        en: Not-for-profit organizations and charities
        fr: organisme à but non lucratif et organisme de bienfaisance
      S:
        en: Academia
        fr: établissement universitaire et institution publique
      A:
        en: Indigenous recipients
        fr: bénéficiaire autochtone
      G:
        en: Government
        fr: gouvernement
      I:
        en: International (non-government)
        fr: organisation internationale (non gouvernementale)
      P:
        en: Individual or sole proprietorships
        fr: particulier ou entreprise à propriétaire unique
      O:
        en: Other
        fr: autre

  # 3.6 Recipient Business Number
  - datastore_id: recipient_business_number
    label:
      en: Recipient Business Number
      fr: Numéro d'entreprise du bénéficiaire
    description:
      en: |
        The Business Number is a nine digit number issued by the Canada Revenue Agency since 1994. Per the Directive on the Business Number, it has been identified as the standard identifier for all transactions between businesses and the Government of Canada, including transactions linked to grant and/or contribution funding.

        This guidance further aligns with the Government of Canada data reference standard on business number: Data reference standard on the business number - Canada.ca (https://www.canada.ca/en/government/system/digital-government/digital-government-innovations/enabling-interoperability/gc-enterprise-data-reference-standards/data-reference-standard-business-number.html)

        The business number should be populated for an organization or charity.

        Real-time validation of business identity information linked to the Business Number, including legal name and operating name, for sole proprietorship, partnerships and incorporations, is available to departments through the Business Number Web Validation Service. For more details contact ic.bnadoptionne.ic@canada.ca.

        To validate a Business Number associated with a charity, departments can access the List of Charities basic search on the Canada.ca website. Enter the Charity name and click the Search button. Then click the Charity name of the search result to find additional information about the charity (e.g., Charity Program number, charity status, effective date of status, designation, etc.) Legal name and operating name cannot be validated using this basic search.

        A business number is issued when an organization is registered federally, provincially or municipally. It does not change and will allow for consistent identification even if the legal name, the operation name or the organization changes over the life cycle of the grant or contribution.
      fr: |
        Depuis 1994, l’Agence du revenu du Canada émet des numéros d’entreprise à neuf chiffres. Aux termes de la Directive sur le numéro d’entreprise, le numéro d’entreprise constitue l’identificateur standard de toutes les opérations effectuées entre une entreprise et le gouvernement du Canada, y compris les opérations associées à une subvention ou à un financement de contribution.

        Cette directive est également conforme à la norme de référence sur les données du numéro d'entreprise du gouvernement du Canada : Norme référentielle relative aux données sur le numéro d’entreprise - Canada.ca (https://www.canada.ca/fr/gouvernement/systeme/gouvernement-numerique/innovations-gouvernementales-numeriques/permettre-interoperabilite/normes-referentielles-pangouvernementales-relatives-donnees-gc/norme-referentielle-relative-donnees-numero-entreprise.html)

        Le numéro d’entreprise devrait être consigné pour une organisation ou un organisme de bienfaisance.

        Les ministères peuvent obtenir la validation en temps réel de l’identité d’une entreprise en saisissant son numéro d’entreprise dans le Service de validation du numéro d’entreprise en ligne, qui inclut le nom légal et le nom commercial pour les entreprises individuelles, les partenariats et les constitutions en personne morale. Si vous voulez obtenir de plus amples renseignements, envoyez un courriel à ic.bnadoptionne.ic@canada.ca.

        Pour valider un numéro d’entreprise associé à un organisme de bienfaisance, les ministères peuvent effectuer une recherche de base dans la Liste d’organismes de bienfaisance, sur le site Web Canada.ca. Entrez le nom de l’organisme de bienfaisance, puis cliquez sur le bouton de Recherche. Ensuite, cliquez sur le nom de l’organisme de bienfaisance tiré du résultat de la recherche afin de trouver de plus amples renseignements sur l’organisme de bienfaisance (p. ex., le numéro du programme de bienfaisance, le statut de l’organisme de bienfaisance, la date d’entrée en vigueur du statut et la désignation de l’organisme de bienfaisance). Il est impossible de valider le nom légal et le nom commercial au moyen de la fonction de recherche de base.
    obligation:
      en: Optional
      fr: Facultatif
    validation:
      en: Must be a 9 digit number if "Agreement Start Date" is on or after December 1st 2025
      fr: Doit être un numéro à neuf chiffres si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text - 9 digit number
      fr: Texte libre - numéro à neuf chiffres
    excel_error_formula: >-
      OR(
        {default_formula},
        AND(
          NOT(
            ISBLANK({agreement_start_date})
          ),
          VALUE({agreement_start_date})>=DATE(2025,12,1),
          OR(
            NOT(ISNUMBER(VALUE({cell}))),
            LEN(TRIM({cell}))<>9,
            MID(TRIM({cell}),1,1)="0",
            LEN({cell})-LEN(SUBSTITUTE({cell},"-",""))>0,
            LEN({cell})-LEN(SUBSTITUTE({cell},".",""))>0,
            LEN({cell})-LEN(SUBSTITUTE({cell},",",""))>0
          )
        )
      )
    # TODO: js error eval
    js_error_eval: >-
      {{agreement_start_date}}.length > 0 &&
      new Date({{agreement_start_date}}) >= new Date("2025-12-01") &&
      VALUE.length > 0 &&
      (
        (
          String(VALUE).match(/^-?[0-9]+$/) != null
          && parseInt(VALUE) < 0
        ) ||
        VALUE.startsWith("0")
      )
    datastore_type: text

  # 3.7 Recipient Legal Name (formerly recipient_name_en, recipient_name_fr)
  - datastore_id: recipient_legal_name
    label:
      en: Recipient Legal Name (English|French)
      fr: Nom légal du bénéficiaire (anglais|français)
    description:
      en: |
        The recipient legal name is meant to complement the existing “Recipient business number” field. It is the legal name of the recipient. This information should be taken from the agreement.

        Only translated if the legal name is provided in both official languages by the recipient.  Provide in the following format: name English|name French.
      fr: |
        Le nom légal du bénéficiaire se veut complémentaire au champ « Numéro d'entreprise du bénéficiaire ». Cette information devrait être tirée de l'entente de subvention ou de contribution.

        Traduction seulement si le nom légal est fourni dans les deux langues officielles par le bénéficiaire. Fournir dans le format suivant : nom anglais|nom français.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    excel_required_formula: 'VALUE({agreement_start_date})>=DATE(2018,4,1)'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01")'
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-lg
    form_attrs:
      size: 60

  # 3.8 Recipient Operating Name (New Field)
  - datastore_id: recipient_operating_name
    label:
      en: Recipient Operating Name (English|French)
      fr: Nom commercial du bénéficiaire (anglais|français)
    description:
      en: |
        The “Recipient operating name” is an optional field used when an organization operates under a name that differs from its legal name or business number. When a researcher receives funding through a university, this information would be populated here. This field is not intended to capture the ultimate recipient of a grant or contribution; instead, the name of the person receiving funding from the Government of Canada should be entered.

        Only translated if the name is provided in both official languages by the recipient. Provide in the following format: Legal name English|Legal name French.
      fr: |
        Le champ « Nom commercial du bénéficiaire » est un champ facultatif utilisé dans le cas d'organisations qui exercent leurs activités sous un nom différent de leur nom légal ou de leur numéro d'entreprise. Dans le cas de chercheurs qui reçoivent leur financement par l'entremise d'une université, cette information doit être entrée ici. Ce champ ne sert pas à saisir le nom du bénéficiaire ultime de la subvention ou de la contribution, mais plutôt celui de la personne qui reçoit le financement du gouvernement du Canada.

        Traduction seulement si le nom est fourni dans les deux langues officielles par le bénéficiaire. Fournir dans le format suivant : nom anglais|nom français.
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-lg
    form_attrs:
      size: 60

  # 3.9 Research Organization (New Field)
  - datastore_id: research_organization_name
    label:
      en: Research Organization (English|French)
      fr: Organisme de recherche (anglais|français)
    description:
      en: |
        The “Research organization” is an optional field for including information about the organization that the recipient represents. This field will be used mainly to highlight academic organizations that researchers have partnered with.

        Only translated if the organization name is provided in both official languages by the recipient in the following format: name English|name French.
      fr: |
        Le champ « Organisme de recherche » est facultatif. Il sert à inclure les renseignements sur l'organisation que le bénéficiaire représente. Ce champ sera surtout utilisé pour mettre en évidence les organisations avec lesquelles les chercheurs ont formé un partenariat.

        Traduction seulement si le nom de l'organisme est fourni dans les deux langues officielles par le bénéficiaire. Fournir dans le format suivant : nom anglais|nom français.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-lg
    form_attrs:
      size: 60

  # 3.10 Recipient Country
  - datastore_id: recipient_country
    label:
      en: Recipient Country
      fr: Pays du bénéficiaire
    description:
      en: The “Recipient country” is a mandatory field. It is the country in which the recipient resides.
      fr: Le « Pays du bénéficiaire » est un champ obligatoire qui indique le pays de résidence du bénéficiaire.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    excel_required_formula: 'VALUE({agreement_start_date})>=DATE(2018,4,1)'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01")'
    datatables_col_class: col-md
    format_type:
      en: Controlled List
      fr: Liste contrôlée
    datastore_type: text
    choices_file: choices/country.json

  # 3.11 Recipient Province or Territory (New Field)
  - datastore_id: recipient_province
    label:
      en: Recipient Province or Territory
      fr: Province ou territoire du bénéficiaire
    description:
      en: The "Recipient province or territory" is a mandatory field if the Recipient Country is Canada and identifies where, within Canada, the recipient resides.
      fr: Le champ « province ou territoire du bénéficiaire » est un champ obligatoire si le pays destinataire est le Canada et indique le lieu de résidence du bénéficiaire au Canada.
    obligation:
      en: Mandatory if Recipient Country is Canada
      fr: Obligatoire si le pays destinataire est le Canada
    format_type:
      en: Controlled List
      fr: Liste contrôlée
    datastore_type: text
    excel_required_formula: AND(VALUE({agreement_start_date})>=DATE(2018,4,1), NOT(ISBLANK({recipient_country})), {recipient_country}="CA")
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01") && {{recipient_country}}.length > 0 && {{recipient_country}} == "CA"'
    choices:
      "ON":
        en: Ontario
        fr: Ontario
      QC:
        en: Quebec
        fr: Québec
      NB:
        en: New Brunswick
        fr: Nouveau-Brunswick
      NL:
        en: Newfoundland & Labrador
        fr: Terre-Neuve-et-Labrador
      PE:
        en: Prince Edward Island
        fr: Île-du-Prince-Édouard
      SK:
        en: Saskatchewan
        fr: Saskatchewan
      YT:
        en: Yukon
        fr: Yukon
      AB:
        en: Alberta
        fr: Alberta
      BC:
        en: British Columbia
        fr: Colombie-Britannique
      MB:
        en: Manitoba
        fr: Manitoba
      NT:
        en: Northwest Territories
        fr: Territoires du Nord-Ouest
      NU:
        en: Nunavut
        fr: Nunavut
      NS:
        en: Nova Scotia
        fr: Nouvelle-Écosse

  # 3.12 Recipient City (previously recipient_region_en, recipient_region_fr)
  - datastore_id: recipient_city
    label:
      en: Recipient City (English|French)
      fr: Ville du bénéficiaire (anglais|français)
    description:
      en: |
        The "Recipient city" is a mandatory field that identifies which city the recipient operates in. This field can be populated with Canadian or foreign cities.

        Official city names should be provided, including both official languages (where applicable in the following format: name English|name French

        Free text, but a controlled list from Canada Revenue Agency’s qualified donees list of municipalities can be consulted: Canada Revenue Agency website (http://www.cra-arc.gc.ca/chrts-gvng/qlfd-dns/mncplts-eng.html).
      fr: |
        La « Ville du bénéficiaire » est un champ obligatoire qui indique la ville où le bénéficiaire exerce ses activités. On peut y inscrire le nom de villes canadiennes ou de villes étrangères.

        Nom officiel exact de la ville, y compris dans les deux langues officielles (le cas échéant) au format suivant : nom anglais|nom français

        Texte libre, mais une liste contrôlée de la liste des municipalités désignées donataires de l’Agence du revenu du Canada peut être consultée: site Web de l’Agence du revenu du Canada (http://www.cra-arc.gc.ca/chrts-gvng/qlfd-dns/mncplts-fra.html).
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    excel_required_formula: 'VALUE({agreement_start_date})>=DATE(2018,4,1)'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01")'
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-lg
    form_attrs:
      size: 60

  # 3.13 Recipient Postal Code (New Field)
  - datastore_id: recipient_postal_code
    label:
      en: Recipient Postal Code
      fr: Code postal du bénéficiaire
    description:
      en: |
        The "Recipient postal code" is a mandatory field that serves to identify the specific area in which the recipient operates. In cases where this field cannot be populated this field may be left blank.

        Should be in the format "A1A 1A1"; The Canada Post tool for looking up a postal code can be found on the Canada Post website.
      fr: |
        Le « Code postal du bénéficiaire » est un champ obligatoire qui sert à identifier avec précision la région où le bénéficiaire exerce ses activités. Si le fait de remplir ce champ suscite des préoccupations à l'égard de la vie privée, il est possible de le laisser vide.

        Devrait être selon le format « A1A 1A1 »; L'outil de Postes Canada permettant de rechercher un code postal se trouve sur le site Web de Postes Canada.
    obligation:
      en: Optional
      fr: Facultatif
    validation:
      en: Must be in the format "A1A 1A1" if "Agreement Start Date" is on or after December 1st 2025
      fr: Doit être selon le format « A1A 1A1 » si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: 'Text - Should be in the format "A1A 1A1"'
      fr: 'Texte - devrait être selon le format « A1A 1A1 »'
    excel_error_formula: >-
      OR(
        {default_formula},
        AND(
          NOT(
            ISBLANK({agreement_start_date})
          ),
          VALUE({agreement_start_date})>=DATE(2025,12,1),
          OR(
            LEFT(TRIM({cell}),3)&" "&RIGHT(TRIM({cell}),3)<>TRIM({cell}),
            CODE(UPPER(MID({cell},1,1)))>CODE("Z"),
            CODE(UPPER(MID({cell},1,1)))<CODE("A"),
            CODE(UPPER(MID({cell},3,1)))>CODE("Z"),
            CODE(UPPER(MID({cell},3,1)))<CODE("A"),
            CODE(UPPER(MID({cell},6,1)))>CODE("Z"),
            CODE(UPPER(MID({cell},6,1)))<CODE("A"),
            MID({cell},4,1)<>" ",
            NOT(
              ISNUMBER(
                VALUE(
                  MID({cell},2,1)&
                  MID({cell},5,1)&
                  MID({cell},7,1)
                )
              )
            )
          )
        )
      )
    # TODO: js error eval
    js_error_eval: >-
      {{agreement_start_date}}.length > 0 &&
      new Date({{agreement_start_date}}) >= new Date("2025-12-01")
    datastore_type: text

  # 3.14 Federal Riding Name (English) (New Field)
  - datastore_id: federal_riding_name_en
    label:
      en: Federal Riding Name (English)
      fr: Nom de la circonscription fédérale (anglais)
    description:
      en: The federal riding name is the name of the riding in which the recipient resides.
      fr: Le nom de la circonscription fédérale où réside le bénéficiaire.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-md
    js_required_eval: '{{federal_riding_name_fr}}.length > 0'
    form_attrs:
      size: 60

  # 3.15 Federal Riding Name (French) (New Field)
  - datastore_id: federal_riding_name_fr
    label:
      en: Federal Riding Name (French)
      fr: Nom de la circonscription fédérale (français)
    description:
      en: The federal riding name is the name of the riding in which the recipient resides.
      fr: Le nom de la circonscription fédérale où réside le bénéficiaire.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-md
    js_required_eval: '{{federal_riding_name_en}}.length > 0'
    form_attrs:
      size: 60

  # 3.16 Federal Riding Number (New Field)
  - datastore_id: federal_riding_number
    label:
      en: Federal Riding Number
      fr: Numéro de la circonscription fédérale
    description:
      en: The federal riding number is based on the riding in which the recipient resides. Departments can consult the Elections Canada website in order to retrieve the federal riding number. http://www.elections.ca/content.aspx?section=res&dir=cir/list&document=index338&lang=e
      fr: Numéro de la circonscription fédérale où réside le bénéficiaire. Les départements peuvent consulter le site-web d’Élections Canada pour trouver le numéro de la circonscription fédérale. http://www.elections.ca/content.aspx?section=res&dir=cir/list&document=index338&lang=f
    obligation:
      en: Optional
      fr: Facultatif
    validation:
      en: Must be a 5 digit number if "Agreement Start Date" is on or after December 1st 2025
      fr: Doit être un numéro à cinq chiffres si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Text - 5 digit number
      fr: Texte - numéro à cinq chiffres
    excel_error_formula: >-
      OR(
        {default_formula},
        AND(
          NOT(
            ISBLANK({agreement_start_date})
          ),
          VALUE({agreement_start_date})>=DATE(2025,12,1),
          OR(
            NOT(ISNUMBER(VALUE({cell}))),
            LEN(TRIM({cell}))<>5,
            MID(TRIM({cell}),1,1)="0",
            LEN({cell})-LEN(SUBSTITUTE({cell},"-",""))>0,
            LEN({cell})-LEN(SUBSTITUTE({cell},".",""))>0,
            LEN({cell})-LEN(SUBSTITUTE({cell},",",""))>0
          )
        )
      )
    # TODO: js error eval
    js_required_eval: >-
      {{agreement_start_date}}.length > 0 &&
      new Date({{agreement_start_date}}) >= new Date("2025-12-01")
    datastore_type: text

  # 3.17 Program Name (English)
  - datastore_id: prog_name_en
    label:
      en: Program Name (English)
      fr: Nom du programme (anglais)
    description:
      en: The program name is the name of the program, according to the terms and conditions (Ts&Cs), under which a recipient is funded.
      fr: Le nom du programme selon les modalités en vertu desquelles le financement est versé au bénéficiaire.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-lg
    js_required_eval: '{{prog_name_fr}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      size: 60

  # 3.18 Program Name (French)
  - datastore_id: prog_name_fr
    label:
      en: Program Name (French)
      fr: Nom du programme (français)
    description:
      en: The program name is the name of the program, according to the terms and conditions (Ts&Cs), under which a recipient is funded.
      fr: Le nom du programme selon les modalités en vertu desquelles le financement est versé au bénéficiaire.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-lg
    js_required_eval: '{{prog_name_en}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      size: 60

  # 3.19 Program Purpose (English) (formerly purpose_en)
  - datastore_id: prog_purpose_en
    label:
      en: Program Purpose (English)
      fr: But du programme (anglais)
    description:
      en: The program purpose is the program’s purpose according to the Ts&Cs.
      fr: Le but du programme est celui dans lequel le programme a été créé, selon les modalités du programme.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    js_required_eval: '{{prog_purpose_fr}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.20 Program Purpose (French) (formerly purpose_fr)
  - datastore_id: prog_purpose_fr
    label:
      en: Program Purpose (French)
      fr: But du programme (français)
    description:
      en: The program purpose is the program’s purpose according to the Ts&Cs.
      fr: Le but du programme est celui dans lequel le programme a été créé, selon les modalités du programme.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    js_required_eval: '{{prog_purpose_en}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.21 Agreement Title (English) (formerly proj_name_en)
  - datastore_id: agreement_title_en
    label:
      en: Agreement Title (English)
      fr: Titre de l’entente (anglais)
    description:
      en: The agreement title is the title of the project or agreement that the recipient is undertaking. In cases where there is no title, the agreement number will be duplicated here.
      fr: Le nom de l'entente est le titre du projet ou de l'entente à l'égard duquel s'engage le bénéficiaire. S'il n'y a pas de titre, le numéro de l'entente peut être réinscrit ici.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-lg
    js_required_eval: '{{agreement_title_fr}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      size: 60

  # 3.22 Agreement Title (French) (formerly proj_name_fr)
  - datastore_id: agreement_title_fr
    label:
      en: Agreement Title (French)
      fr: Titre de l’entente (français)
    description:
      en: The agreement title is the title of the project or agreement that the recipient is undertaking. In cases where there is no title, the agreement number will be duplicated here.
      fr: Le nom de l'entente est le titre du projet ou de l'entente à l'égard duquel s'engage le bénéficiaire. S'il n'y a pas de titre, le numéro de l'entente peut être réinscrit ici.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    datastore_type: text
    datatables_col_class: col-lg
    js_required_eval: '{{agreement_title_en}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01"))'
    form_attrs:
      size: 60

  # 3.23 Agreement Number (formerly prog_number, proj_number)
  - datastore_id: agreement_number
    label:
      en: Agreement Number
      fr: Numéro de l’entente
    description:
      en: The agreement number should be the number on the agreement and/or in the departmental Gs&Cs system.
      fr: Le numéro de l'entente est celui qui figure à l'entente et/ou dans le système de subventions et de contributions du ministère.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text

  # 3.24 Agreement Value in CAD (Formerly Field 3.15 - Value)
  - datastore_id: agreement_value
    label:
      en: Agreement Value in CAD
      fr: Valeur de l’entente en dollars canadiens
    description:
      en: >
        The agreement value is the dollar amount stated in the grant or contribution agreement.
        This field should be populated with a monetary value in Canadian dollars. This field
        should report on the total grant or contribution value, and not the change in agreement value.
      fr: >
        La valeur de l'entente est le montant en dollars indiqué dans l'entente de subvention ou
        de contribution. Ce champ doit indiquer une valeur monétaire en dollars canadiens. Ce champ
        doit indiquer la valeur totale de la subvention ou de la contribution, et non la variation de
        la valeur de l'accord.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: |
        This field must not be empty.
        The number must be greater than 0.
      fr: |
        Ce champ ne doit pas être vide.
        Le nombre doit être supérieur à 0.
    excel_required: true
    form_required: true
    datastore_type: money
    excel_error_formula: >-
      OR(
        {default_formula},
        AND(
          NOT(
            ISBLANK({agreement_start_date})
          ),
          VALUE({agreement_start_date})>=DATE(2025,12,1),
          OR(
            NOT(ISNUMBER(VALUE({cell}))),
            NOT(VALUE({cell})>0)
          )
        )
      )
    # TODO: js error eval
    js_error_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01")'
    solr_dollar_range_facet:
     - 10000
     - 25000
     - 100000
     - 1000000
     - 5000000

  # 3.25 Foreign Currency Type (New field)
  - datastore_id: foreign_currency_type
    label:
      en: Foreign Currency Type
      fr: Type de monnaie étrangère
    description:
      en: |
        The foreign currency type should be selected if a recipient is paid in a currency other than Canadian dollars. Select the type of foreign currency in this field (for example, US dollar (USD), Australian dollar (AUD), British pound (GBP)). This field is mandatory if the agreement is awarded in foreign currency.'

        Foreign currency type is populated using the ISO 4217 alphabetic codes for foreign currency. This list can be found on the XE website. Entry is selected from a drop-down list.

      fr: |
        Le champ Type de monnaie étrangère doit être rempli si le bénéficiaire est payé dans une devise autre que le dollar canadien. Il faut sélectionner le type de monnaie étrangère; par exemple, dollar américain (USD), dollar australien (AUD), livre sterling (GBP). Ce champ est obligatoire si l'entente est en devise étrangère.

        Le type de monnaie étrangère est complété à l'aide des codes alphabétiques ISO 4217 pour les monnaie étrangères. Cette liste se trouve sur le site Web XE. L'entrée est sélectionnée dans une liste déroulante.
    obligation:
      en: Optional (Mandatory when funding provided in foreign currency)
      fr: Facultatif ( obligatoire si le financement est fourni en devise étrangère )
    format_type:
      en: Controlled List
      fr: Liste contrôlée
    datastore_type: text
    excel_required_formula: NOT(ISBLANK({foreign_currency_value}))
    js_required_eval: '{{foreign_currency_value}}.length > 0'
    choices_file: choices/currency.json

  # 3.26 Foreign Currency Value (New field)
  - datastore_id: foreign_currency_value
    label:
      en: Foreign Currency Value
      fr: Valeur de la monnaie étrangère
    description:
      en: The foreign currency value is the amount as signed in the grant or contribution agreement with the recipient. This field should be populated with a monetary value in the foreign currency. This field is mandatory if the agreement is awarded in a foreign currency.
      fr: La valeur en monnaie étrangère est le montant convenu aux termes de l'entente de subvention ou de contribution avec le bénéficiaire. Ce champ doit être rempli en inscrivant la valeur dans la monnaie étrangère. Ce champ est obligatoire si l'entente est en devise étrangère.
    obligation: Mandatory if foreign currency type is selected
    datastore_type: money
    excel_required_formula: NOT(ISBLANK({foreign_currency_type}))
    js_required_eval: '{{foreign_currency_type}}.length > 0'

  # 3.27 Agreement Start Date (Formerly 3.14 "date")
  - datastore_id: agreement_start_date
    label:
      en: Agreement Start Date
      fr: Date de début de l’entente
    description:
      en: |
        The agreement start date is the assumed start of the agreement, normally identified based on the last date of signature, as captured in the initial agreement.

        This date should identify the start of the funding agreement, and not the date of the grant or contribution project.
      fr: |
        La date de début de l'entente est la date d'entrée en vigueur présumée de l'entente, commence généralement à être identifié en fonction de la dernière date de signature, conformément à l'entente initiale.

        Cette date doit indiquer le début de l'accord de financement, et non la date du projet de subvention ou de contribution.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: |
        This field must not be empty.
        Date can’t be in the future.
      fr: |
        Ce champ ne doit pas être vide.
        La date ne doit pas être dans le futur.
    excel_required: true
    form_required: true
    form_snippet: scheming/form_snippets/date.html
    format_type:
      en: Date (Please format the date as YYYY-MM-DD)
      fr: "Date (Veuillez utiliser le format de date suivant : AAAA-MM-JJ)"
    excel_error_formula: 'OR({default_formula},{cell}>TODAY(),AND(NOT(ISBLANK({cell})),NOT(ISBLANK({agreement_end_date})),{cell}>{agreement_end_date}))'
    # TODO: js error eval for future date
    js_error_eval: ''
    datastore_type: date
    extract_date_year: true
    extract_date_month: true
    extract_date_clean: true

  # 3.28 Projected Agreement End Date (New Field)
  - datastore_id: agreement_end_date
    label:
      en: Projected Agreement End Date
      fr: Date de fin prévue de l’entente
    description:
      en: The projected agreement end date is the assumed end of the agreement, or when the project is supposed to end, as captured in the initial agreement.
      fr: La date de fin prévue de l'entente est la date de fin présumée de l'entente, ou la date à laquelle le projet est censé prendre fin, conformément à l'entente initiale.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025.
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après.
    format_type:
      en: Date (Please format the date as YYYY-MM-DD)
      fr: "Date (Veuillez utiliser le format de date suivant : AAAA-MM-JJ)"
    excel_error_formula: 'OR({default_formula},AND(NOT(ISBLANK({agreement_start_date})),NOT(ISBLANK({cell})),{cell}<{agreement_start_date}))'
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01")'
    # TODO: js error eval for date before start date
    js_error_eval: ''
    datastore_type: date
    form_snippet: scheming/form_snippets/date.html

  # 3.29 Coverage (New Field)
  - datastore_id: coverage
    label:
      en: Coverage (English|French; ...)
      fr: Portée (anglais|français; ...)
    description:
      en: Coverage provides information about what will benefit from the project or agreement. Departments should populate this with any information they have available.
      fr: Le champ « Portée » fournit des renseignements sur l'incidence générale prévue du projet ou de l'entente. Les ministères peuvent entrer ici tout renseignement dont ils disposent.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text; separate entries with a “;” and include bilingual entries, where applicable, separated with a “│”
      fr: Texte libre; separate entries with a “;” and include bilingual entries, where applicable, separated with a “│”
    datastore_type: text
    datatables_col_class: col-lg
    form_attrs:
      size: 60

  # 3.30 Description (English) (New Field)
  - datastore_id: description_en
    label:
      en: Description (English)
      fr: Description (anglais)
    description:
      en: The description explains why the recipient received funding. It should provide a brief yet accurate description of what the recipient is undertaking.
      fr: La description explique à quelles fins le bénéficiaire a reçu le financement. Elle doit décrire de façon brève, mais explicite, en quoi consistent les travaux du bénéficiaire.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-xl
    js_required_eval: '{{description_fr}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01"))'
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.31 Description (French) (New Field)
  - datastore_id: description_fr
    label:
      en: Description (French)
      fr: Description (français)
    description:
      en: The description explains why the recipient received funding. It should provide a brief yet accurate description of what the recipient is undertaking.
      fr: La description explique à quelles fins le bénéficiaire a reçu le financement. Elle doit décrire de façon brève, mais explicite, en quoi consistent les travaux du bénéficiaire.
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-xl
    js_required_eval: '{{description_en}}.length > 0 || ({{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2018-04-01"))'
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.32 NAICS Identifier (New Field)
  - datastore_id: naics_identifier
    label:
      en: NAICS Identifier
      fr: Identificateur du SCIAN
    description:
      en: The North American Industry Classification System (NAICS) is an industry classification system developed by the statistical agencies of Canada, Mexico and the United States.
      fr: Le Système de classification des industries de l'Amérique du Nord (SCIAN) est un système de classification des industries conçu par les organismes statistiques du Canada, du Mexique et des États-Unis.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: |
        Free text based on controlled list from Statistics Canada; This list is available to users on the Statistics Canada website. http://www.statcan.gc.ca/eng/subjects/standard/naics/2012/index

        The “NAICS identifier” field should be populated with the most appropriate choice in the selection list. Departments should consult the Statistics Canada website and populate at their own discretion. At least 3 digits should be entered to allow for broad coding when specificity is not possible.

        For example, if Employment and Social Development Canada is signing an agreement with an educational support services organization, the NAICS identifier would be 611710. The identifier is broken down as follows:

        • sector: 61 (educational services)
        • subsector: 1 (educational services)
        • industry group: 7 (educational support services)
        • industry: 10 (educational support services)
      fr: |
        Texte libre basé sur une liste contrôlée de Statistique Canada; cette liste est disponible pour les utilisateurs sur le site Web de Statistique Canada. https://www.statcan.gc.ca/fr/sujets/norme/scian/2012/index

        Le champ « Identifiant SCIAN » doit être rempli avec le choix le plus approprié dans la liste de sélection. Les ministères doivent consulter le site Web de Statistique Canada et le remplir à leur guise. Au moins trois chiffres doivent être saisis pour permettre un codage large lorsque la spécificité n’est pas possible.

        Par exemple, si Emploi et Développement social Canada signe un accord avec un organisme de services de soutien à l’éducation, l’identifiant SCIAN sera 611710. L’identifiant se décompose comme suit :

        • secteur : 61 (services d’enseignement);
        • sous-secteur : 1 (services d’enseignement);
        • groupe industriel : 7 (services de soutien à l’enseignement);
        • industrie : 10 (services de soutien à l’enseignement).
    datastore_type: text

  # 3.33 Expected Results or Intended Outcome (English) (New Field)
  - datastore_id: expected_results_en
    label:
      en: Expected Results or Intended Outcome (English)
      fr: Résultats attendus ou visés (anglais)
    description:
      en: The expected results or intended outcome is the assumed result of project completion. It should be populated in accordance with the project that the recipient is undertaking or the program under which it is funded. This field will attempt to explain why the project is being undertaken, and what the final results should be.
      fr: Les résultats attendus ou visés sont les résultats présumés qui découlent de l'exécution d'un projet. Le champ doit être rempli en fonction du projet qu'entreprend le bénéficiaire ou conformément au programme en vertu duquel il est financé. Ce champ vise à offrir une description de la raisond'être du projet et de ce que devraient être les résultats finaux.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01")'
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.34 Expected Results or Intended Outcome (French) (New Field)
  - datastore_id: expected_results_fr
    label:
      en: Expected Results or Intended Outcome (French)
      fr: Résultats attendus ou visés (français)
    description:
      en: The expected results or intended outcome is the assumed result of project completion. It should be populated in accordance with the project that the recipient is undertaking or the program under which it is funded. This field will attempt to explain why the project is being undertaken, and what the final results should be.
      fr: Les résultats attendus ou visés sont les résultats présumés qui découlent de l'exécution d'un projet. Le champ doit être rempli en fonction du projet qu'entreprend le bénéficiaire ou conformément au programme en vertu duquel il est financé. Ce champ vise à offrir une description de la raisond'être du projet et de ce que devraient être les résultats finaux.
    obligation:
      en: Mandatory
      fr: Obligatoire
    validation:
      en: Required if "Agreement Start Date" is on or after December 1st 2025
      fr: Requis si la "date de début de l’entente" est le 1er décembre 2025 ou après
    format_type:
      en: Free text
      fr: Texte libre
    excel_required_formula: 'AND(NOT(ISBLANK({agreement_start_date})),VALUE({agreement_start_date})>=DATE(2025,12,1))'
    js_required_eval: '{{agreement_start_date}}.length > 0 && new Date({{agreement_start_date}}) >= new Date("2025-12-01")'
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.35 Additional Information (English) (Formerly comments_en, additional_info_en)
  - datastore_id: additional_information_en
    label:
      en: Additional Information (English)
      fr: Renseignements supplémentaires (anglais)
    description:
      en: |
        Additional information is information that departments are required to enter under the guidance instructions for exceptions but that is not captured in any of the aforementioned fields. It may contain information on:

        • additional funding departments
        • funding through a third party
        • ministerial announcements
        • research fields
        • joint funding
        • collaborators and partners
        • keywords
        • belated reporting
        • novation agreements
        • terminations
        • repayability
      fr: |
        Lorsqu'ils sont tenus de le faire conformément aux « Indications » qui traitent des exceptions, les ministères doivent entrer ici les renseignements supplémentaires qui ne sont pas saisis dans les champs précédents. Il peut s'agir de renseignements comme ceux-ci :

        • autres ministères participent au financement;
        • financement par l'intermédiaire d'un tiers;
        • annonces ministérielles;
        • domaines de recherche;
        • financement conjoint;
        • collaborateurs et partenaires;
        • mots-clés;
        • divulgation tardive;
        • entente d'innovation;
        • résiliations;
        • remboursement.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  # 3.36 Additional Information (French) (Formerly comments_fr, additional_info_fr)
  - datastore_id: additional_information_fr
    label:
      en: Additional Information (French)
      fr: Renseignements supplémentaires (français)
    description:
      en: |
        Additional information is information that departments are required to enter under the guidance instructions for exceptions but that is not captured in any of the aforementioned fields. It may contain information on:

        • additional funding departments
        • funding through a third party
        • ministerial announcements
        • research fields
        • joint funding
        • collaborators and partners
        • keywords
        • belated reporting
        • novation agreements
        • terminations
        • repayability
      fr: |
        Lorsqu'ils sont tenus de le faire conformément aux « Indications » qui traitent des exceptions, les ministères doivent entrer ici les renseignements supplémentaires qui ne sont pas saisis dans les champs précédents. Il peut s'agir de renseignements comme ceux-ci :

        • autres ministères participent au financement;
        • financement par l'intermédiaire d'un tiers;
        • annonces ministérielles;
        • domaines de recherche;
        • financement conjoint;
        • collaborateurs et partenaires;
        • mots-clés;
        • divulgation tardive;
        • entente d'innovation;
        • résiliations;
        • remboursement.
    obligation:
      en: Optional
      fr: Facultatif
    format_type:
      en: Free text
      fr: Texte libre
    datastore_type: text
    datatables_col_class: col-xxl
    form_snippet: scheming/form_snippets/textarea.html
    form_attrs:
      class: form-control canada-width-full d-block
    markdown: true

  - datastore_id: record_created
    label: Record Creation Time
    import_template_include: false
    visible_to_public: false
    datastore_type: timestamp
    preview_class: bg-info

  - datastore_id: record_modified
    label: Last Record Modification Time
    import_template_include: false
    visible_to_public: false
    datastore_type: timestamp
    preview_class: bg-info

  - datastore_id: user_modified
    label: User Last Modified Record
    import_template_include: false
    visible_to_public: false
    datastore_type: text
    preview_class: bg-info

  datastore_primary_key: [ref_number, amendment_number]
  datastore_indexes: ""
  excel_organization_style:
    PatternFill:
      patternType: solid
      fgColor: FFd35c37
    Font:
      color: FFFFFF
      size: 14
  excel_header_style:
    PatternFill:
      patternType: solid
      fgColor: FFc09a77

  triggers:
  - grants_trigger: |
      DECLARE
        errors text[][] := '{{}}';
        crval RECORD;
      BEGIN
        errors := errors || required_error(NEW.ref_number, 'ref_number');
        IF NEW.ref_number LIKE '%,%' THEN
          errors := errors || ARRAY[['ref_number', {ref_number_error}]];
        END IF;

        errors := errors || required_error(NEW.amendment_number, 'amendment_number');
        IF NEW.amendment_number <> 0 THEN
          errors := errors || required_error(NEW.amendment_date, 'amendment_date');
        END IF;

        IF NOT ((NEW.foreign_currency_type = '') IS NOT FALSE) OR
                NEW.foreign_currency_value IS NOT NULL THEN
          errors := errors || required_error(NEW.foreign_currency_type, 'foreign_currency_type');
          errors := errors || choice_error(NEW.foreign_currency_type, {foreign_currency_type}, 'foreign_currency_type');
          errors := errors || required_error(NEW.foreign_currency_value, 'foreign_currency_value');
        END IF;

        errors := errors || required_error(NEW.agreement_value, 'agreement_value');

        errors := errors || required_error(NEW.agreement_start_date, 'agreement_start_date');
        IF NEW.agreement_start_date >= '2018-04-01'::date THEN
          errors := errors || required_error(NEW.agreement_type, 'agreement_type');
          errors := errors || choice_error(NEW.agreement_type, {agreement_type}, 'agreement_type');
          IF NOT ((NEW.recipient_type = '') IS NOT FALSE) THEN
            errors := errors || choice_error(NEW.recipient_type, {recipient_type}, 'recipient_type');
          END IF;
          errors := errors || required_error(NEW.recipient_legal_name, 'recipient_legal_name');
          errors := errors || required_error(NEW.recipient_country, 'recipient_country');
          errors := errors || choice_error(NEW.recipient_country, {recipient_country}, 'recipient_country');
          IF NEW.recipient_country = 'CA' THEN
            errors := errors || required_error(NEW.recipient_province, 'recipient_province');
            errors := errors || choice_error(NEW.recipient_province, {recipient_province}, 'recipient_province');
          END IF;
          errors := errors || required_error(NEW.recipient_city, 'recipient_city');
          errors := errors || required_error(NEW.description_en, 'description_en');
          errors := errors || required_error(NEW.description_fr, 'description_fr');
        END IF;

        NEW.agreement_value := round(NEW.agreement_value, 2);
        NEW.foreign_currency_value := round(NEW.foreign_currency_value, 2);

        IF NEW.agreement_start_date >= '2025-12-01'::date THEN
          errors := errors || conditional_required_error(NEW.recipient_type, 'recipient_type');

          errors := errors || conditional_required_error(NEW.prog_name_en, 'prog_name_en');
          errors := errors || conditional_required_error(NEW.prog_name_fr, 'prog_name_fr');

          errors := errors || conditional_required_error(NEW.prog_purpose_en, 'prog_purpose_en');
          errors := errors || conditional_required_error(NEW.prog_purpose_fr, 'prog_purpose_fr');

          errors := errors || conditional_required_error(NEW.agreement_title_en, 'agreement_title_en');
          errors := errors || conditional_required_error(NEW.agreement_title_fr, 'agreement_title_fr');

          errors := errors || future_date_error(NEW.agreement_start_date, 'agreement_start_date');

          errors := errors || conditional_required_error(NEW.agreement_end_date, 'agreement_end_date');
          IF NEW.agreement_start_date::timestamp > NEW.agreement_end_date::timestamp THEN
            errors := errors || ARRAY[['agreement_start_date', {start_end_date_error}]];
          END IF;

          errors := errors || conditional_required_error(NEW.expected_results_en, 'expected_results_en');
          errors := errors || conditional_required_error(NEW.expected_results_fr, 'expected_results_fr');

          NEW.recipient_postal_code := trim_lead_trailing(NEW.recipient_postal_code);
          NEW.recipient_postal_code := UPPER(NEW.recipient_postal_code);
          NEW.recipient_postal_code := REGEXP_REPLACE(NEW.recipient_postal_code, '\s+', ' ', 'g');
          IF NEW.recipient_postal_code IS NOT NULL AND NEW.recipient_postal_code <> '' AND NOT NEW.recipient_postal_code ~ '^[A-Z]\d[A-Z]\s\d[A-Z]\d$' THEN
            errors := errors || ARRAY[['recipient_postal_code', {recipient_postal_code_error}]];
          END IF;

          NEW.recipient_business_number := trim_lead_trailing(NEW.recipient_business_number);
          IF NEW.recipient_business_number IS NOT NULL AND NEW.recipient_business_number <> '' AND (NOT is_natural_number(NEW.recipient_business_number) OR (is_natural_number(NEW.recipient_business_number) AND LENGTH(NEW.recipient_business_number) != 9)) THEN
            errors := errors || ARRAY[['recipient_business_number', {recipient_business_number_error}]];
          END IF;

          NEW.federal_riding_number := trim_lead_trailing(NEW.federal_riding_number);
          IF NEW.federal_riding_number IS NOT NULL AND NEW.federal_riding_number <> '' AND (NOT is_natural_number(NEW.federal_riding_number) OR (is_natural_number(NEW.federal_riding_number) AND LENGTH(NEW.federal_riding_number) != 5)) THEN
            errors := errors || ARRAY[['federal_riding_number', {federal_riding_number_error}]];
          END IF;

          IF NOT NEW.agreement_value > 0 THEN
            errors := errors || ARRAY[['agreement_value', {agreement_value_error}]];
          END IF;

        END IF;

        IF errors = '{{}}' THEN
          RETURN NEW;
        END IF;
        RAISE EXCEPTION E'TAB-DELIMITED\t%', array_to_string(errors, E'\t');
      END;

  - update_record_modified_created_trigger

  trigger_strings:  # yaml | not supported
    ref_number_error: Comma is not allowed in Reference Number field
    recipient_postal_code_error: 'Must be a valid Canadian postal code in the format of "A1A 1A1"'
    recipient_business_number_error: Must be a 9 digit number
    federal_riding_number_error: Must be a 5 digit number
    start_end_date_error: '"Agreement Start Date" cannot be after "Projected Agreement End Date"'
    agreement_value_error: Must be greater than zero

  examples:
    record:
      ref_number: "001-2018-2019-Q2-00045"
      amendment_number: "3"
      amendment_date: "2018-04-01"
      agreement_type: "G"
      recipient_type: "G"
      recipient_business_number: "123456789"
      recipient_legal_name: "ACME Services Limited|Services ACME Limitée"
      recipient_operating_name: "ACME"
      research_organization_name: "York University|Université York"
      recipient_country: "CA"
      recipient_province: "ON"
      recipient_city: "Grand Falls|Grand-Sault"
      recipient_postal_code: "A1A 1A1"
      federal_riding_name_en: "Winnipeg South Centre"
      federal_riding_name_fr: "Winnipeg-Centre-Sud"
      federal_riding_number: "46014"
      prog_name_en: "Canada Granting Program"
      prog_name_fr: "Le programme de subvention du Canada"
      prog_purpose_en: "The Canada Granting Program encourage Canadians to learn about Canada’s geography, history, and economy. The Program provides networking opportunities to enhance recipients’ understanding of Canada."
      prog_purpose_fr: "Le programme de subventions du Canada incite les Canadiens à se renseigner sur la géographie, l’histoire et l’économie du Canada. Le programme offre des opportunités de réseautage pour aider les bénéficiaires d’améliorer leur compréhension du Canada."
      agreement_title_en: "Building better buildings"
      agreement_title_fr: "Construire des meilleurs bâtiments"
      agreement_number: "F1580-140737"
      agreement_value: "500000"
      foreign_currency_type: "USD"
      foreign_currency_value: "450000"
      agreement_start_date: "2025-04-01"
      agreement_end_date: "2026-04-30"
      coverage: "Canada; Mexico|Mexique; United States|États-Unis"
      description_en: "Developing models and other tools to predict the safety performance of buildings."
      description_fr: "Met au point des modèles et d'autres outils pour prévoir la sécurité des bâtiments."
      naics_identifier: "611710"
      expected_results_en: "Develop highly qualified personnel available to pursue various careers within industry, academia, government and other sectors of the economy."
      expected_results_fr: "Développé un personnel hautement qualifié prêt à mener une carrière variée au sein de l’industrie, du milieu académique, de la fonction publique ou dans d’autres secteurs de l’économie."
      additional_information_en: "Recipient reallocates or redistributes grant or contribution awarded to third-party beneficiaries"
      additional_information_fr: "Le bénéficiaire réaffecte ou redistribue la subvention ou la contribution octroyée à des tiers"

    filters:
      recipient_province: "ON"
    filter_one:
      ref_number: "001-2018-2019-Q2-00045"
      amendment_number: "0"
    sort: agreement_date desc


- title: Proactive Publication - Grants and Contributions Nothing to Report
  resource_name: grants-nil

  published_resource_id: 4e4db232-f5e8-43c7-b8b2-439eb7d55475

  create_form: true
  edit_form: false #edit not possible for nil reports since only stored data is primary key
  fields:

  - datastore_id: fiscal_year
    label:
      en: Year
      fr: Année
    datastore_type: text
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    extract_date_year: true
    datatables_col_class: col-md
    choices_file: choices/fiscal_year.yaml

  - datastore_id: quarter
    label:
      en: Quarter
      fr: Trimestre
    datastore_type: text
    obligation:
      en: Mandatory
      fr: Obligatoire
    excel_required: true
    form_required: true
    datatables_col_class: col-sm pd-datatables-primary-key-offset-md
    choices:
      Q1:
        en: April 1 - June 30
        fr: 1 avril - 30 juin
      Q2:
        en: July 1 - September 30
        fr: 1 juillet - 30 septembre
      Q3:
        en: October 1 - December 31
        fr: 1 octobre - 31 décembre
      Q4:
        en: January 1 - March 31
        fr: 1 janvier - 31 mars

  - datastore_id: record_created
    label: Record Creation Time
    import_template_include: false
    visible_to_public: false
    datastore_type: timestamp
    preview_class: bg-info

  - datastore_id: record_modified
    label: Last Record Modification Time
    import_template_include: false
    visible_to_public: false
    datastore_type: timestamp
    preview_class: bg-info

  - datastore_id: user_modified
    label: User Last Modified Record
    import_template_include: false
    visible_to_public: false
    datastore_type: text
    preview_class: bg-info

  solr_static_fields:
    nothing_to_report_en: Nothing to report for this period
    nothing_to_report_fr: Rien à signaler pour cette période
    amendment_number: current

  datastore_primary_key: [fiscal_year, quarter]
  datastore_indexes: ""

  triggers:
  - grants_nil_trigger: |
      DECLARE
        errors text[][] := '{{}}';
        crval RECORD;
      BEGIN
        errors := errors || required_error(NEW.fiscal_year, 'fiscal_year');
        errors := errors || choice_error(NEW.fiscal_year, {fiscal_year}, 'fiscal_year');
        errors := errors || required_error(NEW.quarter, 'quarter');
        errors := errors || choice_error(NEW.quarter, {quarter}, 'quarter');
        IF errors = '{{}}' THEN
          RETURN NEW;
        END IF;
        RAISE EXCEPTION E'TAB-DELIMITED\t%', array_to_string(errors, E'\t');
      END;
  - update_record_modified_created_trigger

  examples:
    record:
      fiscal_year: 2016-2017
      quarter: Q2
    filters:
      fiscal_year: 2016-2017
    filter_one:
      fiscal_year: 2016-2017
      quarter: Q2
    sort: fiscal_year desc, quarter desc

# https://design.gccollab.ca/component/colour "Triad" colours 2, 5
excel_edge_style:
  PatternFill:
    patternType: solid
    fgColor: FF024571
excel_header_style:
  PatternFill:
    patternType: solid
    fgColor: FFEDDB7C
excel_column_heading_style:
  PatternFill:
    patternType: solid
    fgColor: FFEDDB7C
datatables_style:
  header:
    bgColor: EDDB7C
  select:
    bgColor: f6edbf
    fgColor: 333333
