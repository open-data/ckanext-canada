window.addEventListener("load",function(){$(document).ready(function(){const e=$("html").attr("lang").length>0?$("html").attr("lang"):"en";let t=$(".resource-upload-field.form-group"),n=$("#field-resource_type"),o=$("#field-character_set"),a=$("#field-format");function s(){$(".canada-guess-mimetype-alert").remove()}function l(e){let t=$('meta[name="csrf_field_name"]').attr("content"),n=$('meta[name="'+t+'"]').attr("content");payload={url:e},payload[t]=n,$.ajax({url:"/api/action/canada_guess_mimetype",type:"POST",dataType:"JSON",data:payload,complete:function(e){e.responseJSON&&e.responseJSON.success?r(e.responseJSON.result):r("")}})}function r(n){0==$(a).find('option[value="'+n+'"]').length&&(n=""),$(a).val(n).trigger("change"),n.length>0&&function(n){let o="Set Resource Format to <strong>"+n+"</strong>";"fr"==e&&(o="Établissez le format de la ressource à <strong>"+n+"</strong>"),$(t).after('<div class="module-alert alert alert-info mrgn-tp-sm mrgn-bttm-sm canada-guess-mimetype-alert" style="margin-left: 3px;"><p>'+o+"</p></div>")}(n)}function i(){$(o).val("UTF-8").trigger("change"),$(n).val("dataset").trigger("change"),r("CSV")}a.length>0&&($(a).select2({}),$(a).parent().children("#s2id_field-format").addClass("conrtol-medium").removeClass("form-control").removeClass("form-select").css({display:"block"})),function e(){let t=$("input#field-resource-url"),n=$("input#field-resource-upload"),o=$("button#resource-table-designer-button"),a=$("button.btn-remove-url");a.length>0&&$(a).each(function(t,n){$(n).off("click.reset_guessing"),$(n).on("click.reset_guessing",function(t){s(),e()}),$(n).off("keyup.reset_guessing"),$(n).on("keyup.reset_guessing",function(t){let n=t.keyCode?t.keyCode:t.which;32!=n&&13!=n||(s(),e())})}),$(t).off("change.guess_mimetype"),$(t).on("change.guess_mimetype",function(e){s();let n=$(t).val();n.length>0&&l(n)}),$(n).off("change.guess_mimetype"),$(n).on("change.guess_mimetype",function(e){s();const t=e.target.files[0];let n="";t&&(n=t.name),n.length>0&&l(n)}),$(o).off("click.set_mimetype"),$(o).on("click.set_mimetype",function(e){s(),i()}),$(o).off("keyup.set_mimetype"),$(o).on("keyup.set_mimetype",function(e){let t=e.keyCode?e.keyCode:e.which;32!=t&&13!=t||(s(),i())})}()})});